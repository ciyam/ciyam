`{`;Usage: xrep @ciyam_class.cpp.xrep user_vars=model_class.vars.xrep`}
`{`}
`{`#$user_vars @`}
`{`}
`{`;(mandatory)$class_id='cid'`}
`{`;(mandatory)$class_name='cname'`}
`{`;(mandatory)$plural_name='pname'`}
`{`;(mandatory)$class_version='1'`}
`{`;(mandatory)$module_id='mid'`}
`{`;(mandatory)$module_name='mname'`}
`{`;(mandatory)$year_created='2002'`}
`{`}
`{`;$all_fields='name1,type1,id1 name2,type2,id2 name3,type3,id3 name4,type4,id4 name5,type5,id5...'`}
`{`;$order_field='name1'`}
`{`;$basic_fields='name1 ...'`}
`{`;$complex_fields='name2 ...'`}
`{`;$parent_fields='name4 ...'`}
`{`;$file_field_names='name3 ...'`}
`{`;$transient_fields='id2,name2 ...'`}
`{`;$text_search_fields='name1 name5 ...'`}
`{`}
`{`;$commandable_fields='name3,type3 ...'`}
`{`}
`{`;$mandatory_parent_fields='name4 ...'`}
`{`}
`{`;$base_fields='name2,id2 ...'`}
`{`}
`{`;$base_related_types='type5 ...'`}
`{`}
`{`;$child_info='name5,type5,fk_name,fk_id,cascade_op ...'`}
`{`}
`{`;$child_types='type5 ...'`}
`{`;$parent_types='type4 ...'`}
`{`}
`{`;$customised_types='...'(such as numeric and date_time that need includes)`}
`{`}
`{`;$fixed_key='val'`}
`{`}
`{`;$parent_class='...'`}
`{`}
`{`;$all_indexes='name1,name3;bool,string ...'`}
`{`;$all_unique_indexes='name1,name3 ...'`}
`{`}
`{`;$sql_columns='C_Key_ VARCHAR(32), C_Ver_ INTEGER NOT NULL, ...'`}
`{`;$sql_numeric_fields='name1 ...'`}
`{`}
`{`;$all_sql_indexes='C_name1,C_name3 ...'`}
`{`;$all_sql_unique_indexes='C_name1,C_name3 ...'`}
`{`}
`{`;$all_procedures='procedure1 ...'`}
`{`}
`{`;$procedure1_all_args='arg1,type1 arg2,type2 arg3,type3 ...'`}
`{`;$procedure1_all_inputs='arg1,type1 arg2,type2 ...'`}
`{`;$procedure1_all_outputs='arg3,type3 ...'`}
`{`;(mandatory if any procedure args)$procedure1_all_simple_inputs='arg1 ...'`}
`{`;(mandatory if any procedure args)$procedure1_all_complex_inputs='arg2 ...'`}
`{`}
`{`;$all_specifications='spec1,type1 spec2,type1 ...'`}
`{`;$all_specification_types='type1 ...'`}
`{`}
`{`;The variables above need to be provided whereas the following variables are derived here.`}
`{`}
`{`(`!`@eq`(`$class_version`,`'1`'`)`)`$use_transform`=`'`'`}
`{`}
`{`$full_class_name`=`$module_name`}
`{`$full_class_name`^`'_`'`}
`{`$full_class_name`^`$class_name`}
`{`}
`{`(`?`$all_fields`)`|`(`?`$base_fields`)`$all_and_base_fields`=`'`'`}
`{`(`?`$base_fields`)`[`$base_fields`%,`,\
`{`$all_and_base_fields`=`$all_and_base_fields`+`'\0`'`}\
`{`$all_and_base_fields`^`',\1`'`}`]`}
`{`(`?`$all_fields`)`[`$all_fields`%,`,\
`{`$all_and_base_fields`=`$all_and_base_fields`+`'\0`'`}\
`{`$all_and_base_fields`^`',\2`'`}`]`}
`{`}
`{`(`?`$all_fields`)`$all_field_ids`=`'`'`}
`{`(`?`$all_fields`)`$all_field_names`=`'`'`}
`{`(`?`$all_fields`)`[`$all_fields`%,`,\
`{`$all_field_ids`=`$all_field_ids`+`'\2`'`}`{`$all_field_names`=`$all_field_names`+`'\0`'`}`]`}
`{`}
`{`(`?`$all_field_ids`)`$all_sorted_field_ids`=`@sort`(`$all_field_ids`)`}
`{`(`?`$all_field_names`)`$all_sorted_field_names`=`@sort`(`$all_field_names`)`}
`{`}
`{`(`?`$base_related_types`|`?`$child_types`|`?`$parent_types`)`$related_types`=`'`'`}
`{`(`?`$base_related_types`)`$related_types`=`$related_types`+`$base_related_types`}
`{`(`?`$child_types`)`$related_types`=`$related_types`+`$child_types`}
`{`(`?`$parent_types`)`$related_types`=`$related_types`+`$parent_types`}
`{`}
`{`(`?`$parent_fields`)`$any_commandable_fields`=`'`'`}
`{`(`?`$commandable_fields`)`$any_commandable_fields`=`'`'`}
`{`}
`{`(`!`?`$parent_fields`)`$parent_fields`=`'`'`}
`{`}
`{`(`?`$basic_fields`|`?`$complex_fields`)`$standard_fields`=`'`'`}
`{`(`?`$basic_fields`)`$standard_fields`=`$standard_fields`+`$basic_fields`}
`{`(`?`$complex_fields`)`$standard_fields`=`$standard_fields`+`$complex_fields`}
`{`}
`{`(`?`$transient_fields`)`$transient_field_ids`=`'`'`}
`{`(`?`$transient_fields`)`$transient_field_names`=`'`'`}
`{`(`?`$transient_fields`)`[`$transient_fields`%,`,\
`{`$transient_field_ids`=`$transient_field_ids`+`'\0`'`}\
`{`$transient_field_names`=`$transient_field_names`+`'\1`'`}\
`]`}
`{`(`?`$transient_field_ids`)`$transient_sorted_field_ids`=`@sort`(`$transient_field_ids`)`}
`{`(`?`$transient_field_names`)`$transient_sorted_field_names`=`@sort`(`$transient_field_names`)`}
`{`}
`{`(`?`$all_fields`)`$non_transient_fields`=`'`'`}
`{`?`$all_fields`[`$all_fields`%,`,\
`{`!`?`$transient_field_names`|`!`@in`(`'\0`'`,`$transient_field_names`)\
`{`$non_transient_fields`=`$non_transient_fields`+`'\0`'`}\
`}`]`}
`{`}
`{`?`$all_procedures`[`$all_procedures`,`{`?`$\$_all_args`$\$_all_non_inputs`=`'`'`}`]`}
`{`?`$all_procedures`[`$all_procedures`,`{`?`$\$_all_outputs`[`$\$_all_outputs`%,`,`{`$\$_all_non_inputs`=`$\$_all_non_inputs`+`'\\0`'`}`]`}`]`}
`{`}
`{`$all_includes_specifications`=`'`'`}
`{`$all_to_store_specifications`=`'`'`}
`{`$all_validate_specifications`=`'`'`}
`{`$all_anonymous_specifications`=`'`'`}
`{`$all_at_create_specifications`=`'`'`}
`{`$all_for_store_specifications`=`'`'`}
`{`$all_get_state_specifications`=`'`'`}
`{`$all_post_init_specifications`=`'`'`}
`{`$all_procedure_specifications`=`'`'`}
`{`$all_transform_specifications`=`'`'`}
`{`$all_after_fetch_specifications`=`'`'`}
`{`$all_after_store_specifications`=`'`'`}
`{`$all_can_destroy_specifications`=`'`'`}
`{`$all_for_destroy_specifications`=`'`'`}
`{`$all_is_filtered_specifications`=`'`'`}
`{`$all_after_destroy_specifications`=`'`'`}
`{`$all_finalise_fetch_specifications`=`'`'`}
`{`$all_static_class_init_specifications`=`'`'`}
`{`$all_static_class_term_specifications`=`'`'`}
`{`$all_add_extra_fixed_info_specifications`=`'`'`}
`{`$all_add_extra_paging_info_specifications`=`'`'`}
`{`$all_value_will_be_provided_specifications`=`'`'`}
`{`$all_get_required_field_names_specifications`=`'`'`}
`{`$all_get_always_required_field_names_specifications`=`'`'`}
`{`$all_get_transient_replacement_field_names_specifications`=`'`'`}
`{`?`$all_specifications`[`$all_specifications`%,`,\
`{`(`?`$specification_\0_sections`)`[`$specification_\0_sections`,\
`{`$all_\\$_specifications`=`$all_\\$_specifications`+`'\0,\1`'`}`]`}\
`]`}
`{`;NOTE: These specific procedure checks can be removed when modeller.exe is no longer used.`}
`{`?`$all_specifications`[`$all_specifications`%,`,\
`{`(`?`$specification_\0_proc`)`$all_procedure_specifications`=`$all_procedure_specifications`+`'\0,\1`'`}\
`{`(`?`$specification_\0_fetch`)`$all_procedure_specifications`=`$all_procedure_specifications`+`'\0,\1`'`}\
`{`(`?`$specification_\0_pggen`)`$all_procedure_specifications`=`$all_procedure_specifications`+`'\0,\1`'`}\
`{`(`?`$specification_\0_chkproc`)`$all_procedure_specifications`=`$all_procedure_specifications`+`'\0,\1`'`}\
`{`(`?`$specification_\0_conproc`)`$all_procedure_specifications`=`$all_procedure_specifications`+`'\0,\1`'`}\
`{`(`?`$specification_\0_genproc`)`$all_procedure_specifications`=`$all_procedure_specifications`+`'\0,\1`'`}\
`{`(`?`$specification_\0_remproc`)`$all_procedure_specifications`=`$all_procedure_specifications`+`'\0,\1`'`}\
`{`(`?`$specification_\0_dn_proc`)`$all_procedure_specifications`=`$all_procedure_specifications`+`'\0,\1`'`}\
`{`(`?`$specification_\0_up_proc`)`$all_procedure_specifications`=`$all_procedure_specifications`+`'\0,\1`'`}\
`{`(`?`$specification_\0_inc_proc`)`$all_procedure_specifications`=`$all_procedure_specifications`+`'\0,\1`'`}\
`{`(`?`$specification_\0_mark_read`)`$all_procedure_specifications`=`$all_procedure_specifications`+`'\0,\1`'`}\
`{`(`?`$specification_\0_mark_proc`)`$all_procedure_specifications`=`$all_procedure_specifications`+`'\0,\1`'`}\
`{`(`?`$specification_\0_send_proc`)`$all_procedure_specifications`=`$all_procedure_specifications`+`'\0,\1`'`}\
`{`(`?`$specification_\0_procedure`)`$all_procedure_specifications`=`$all_procedure_specifications`+`'\0,\1`'`}\
`{`(`?`$specification_\0_move_trash`)`$all_procedure_specifications`=`$all_procedure_specifications`+`'\0,\1`'`}\
`{`(`?`$specification_\0_delete_proc`)`$all_procedure_specifications`=`$all_procedure_specifications`+`'\0,\1`'`}\
`{`(`?`$specification_\0_empty_trash`)`$all_procedure_specifications`=`$all_procedure_specifications`+`'\0,\1`'`}\
`{`(`?`$specification_\0_recover_proc`)`$all_procedure_specifications`=`$all_procedure_specifications`+`'\0,\1`'`}\
`{`(`?`$specification_\0_gen_procedure`)`$all_procedure_specifications`=`$all_procedure_specifications`+`'\0,\1`'`}\
`{`(`?`$specification_\0_calc_procedure`)`$all_procedure_specifications`=`$all_procedure_specifications`+`'\0,\1`'`}\
`{`(`?`$specification_\0_accept_procedure`)`$all_procedure_specifications`=`$all_procedure_specifications`+`'\0,\1`'`}\
`{`(`?`$specification_\0_reject_procedure`)`$all_procedure_specifications`=`$all_procedure_specifications`+`'\0,\1`'`}\
`{`(`?`$specification_\0_confirm_procedure`)`$all_procedure_specifications`=`$all_procedure_specifications`+`'\0,\1`'`}\
`{`(`?`$specification_\0_forward_procedure`)`$all_procedure_specifications`=`$all_procedure_specifications`+`'\0,\1`'`}\
`{`(`?`$specification_\0_mark_as_read_proc`)`$all_procedure_specifications`=`$all_procedure_specifications`+`'\0,\1`'`}\
`{`(`?`$specification_\0_move_to_junk_proc`)`$all_procedure_specifications`=`$all_procedure_specifications`+`'\0,\1`'`}\
`{`(`?`$specification_\0_complete_procedure`)`$all_procedure_specifications`=`$all_procedure_specifications`+`'\0,\1`'`}\
`{`(`?`$specification_\0_move_to_trash_proc`)`$all_procedure_specifications`=`$all_procedure_specifications`+`'\0,\1`'`}\
`{`(`?`$specification_\0_fetch_messages_proc`)`$all_procedure_specifications`=`$all_procedure_specifications`+`'\0,\1`'`}\
`{`(`?`$specification_\0_move_to_parent_folder_proc`)`$all_procedure_specifications`=`$all_procedure_specifications`+`'\0,\1`'`}\
`]`}
`{`?`$all_specifications`[`$all_specifications`%,`,\
`{`(`!`?`$specification_\0_sections`)`$all_includes_specifications`=`$all_includes_specifications`+`'\0,\1`'`}\
`{`(`!`?`$specification_\0_sections`)`$all_to_store_specifications`=`$all_to_store_specifications`+`'\0,\1`'`}\
`{`(`!`?`$specification_\0_sections`)`$all_validate_specifications`=`$all_validate_specifications`+`'\0,\1`'`}\
`{`(`!`?`$specification_\0_sections`)`$all_anonymous_specifications`=`$all_anonymous_specifications`+`'\0,\1`'`}\
`{`(`!`?`$specification_\0_sections`)`$all_at_create_specifications`=`$all_at_create_specifications`+`'\0,\1`'`}\
`{`(`!`?`$specification_\0_sections`)`$all_for_store_specifications`=`$all_for_store_specifications`+`'\0,\1`'`}\
`{`(`!`?`$specification_\0_sections`)`$all_get_state_specifications`=`$all_get_state_specifications`+`'\0,\1`'`}\
`{`(`!`?`$specification_\0_sections`)`$all_post_init_specifications`=`$all_post_init_specifications`+`'\0,\1`'`}\
`{`(`!`?`$specification_\0_sections`)`$all_transform_specifications`=`$all_transform_specifications`+`'\0,\1`'`}\
`{`(`!`?`$specification_\0_sections`)`$all_after_fetch_specifications`=`$all_after_fetch_specifications`+`'\0,\1`'`}\
`{`(`!`?`$specification_\0_sections`)`$all_after_store_specifications`=`$all_after_store_specifications`+`'\0,\1`'`}\
`{`(`!`?`$specification_\0_sections`)`$all_can_destroy_specifications`=`$all_can_destroy_specifications`+`'\0,\1`'`}\
`{`(`!`?`$specification_\0_sections`)`$all_for_destroy_specifications`=`$all_for_destroy_specifications`+`'\0,\1`'`}\
`{`(`!`?`$specification_\0_sections`)`$all_is_filtered_specifications`=`$all_is_filtered_specifications`+`'\0,\1`'`}\
`{`(`!`?`$specification_\0_sections`)`$all_after_destroy_specifications`=`$all_after_destroy_specifications`+`'\0,\1`'`}\
`{`(`!`?`$specification_\0_sections`)`$all_finalise_fetch_specifications`=`$all_finalise_fetch_specifications`+`'\0,\1`'`}\
`{`(`!`?`$specification_\0_sections`)`$all_static_class_init_specifications`=`$all_static_class_init_specifications`+`'\0,\1`'`}\
`{`(`!`?`$specification_\0_sections`)`$all_static_class_term_specifications`=`$all_static_class_term_specifications`+`'\0,\1`'`}\
`{`(`!`?`$specification_\0_sections`)`$all_add_extra_fixed_info_specifications`=`$all_add_extra_fixed_info_specifications`+`'\0,\1`'`}\
`{`(`!`?`$specification_\0_sections`)`$all_add_extra_paging_info_specifications`=`$all_add_extra_paging_info_specifications`+`'\0,\1`'`}\
`{`(`!`?`$specification_\0_sections`)`$all_value_will_be_provided_specifications`=`$all_value_will_be_provided_specifications`+`'\0,\1`'`}\
`{`(`!`?`$specification_\0_sections`)`$all_get_required_field_names_specifications`=`$all_get_required_field_names_specifications`+`'\0,\1`'`}\
`{`(`!`?`$specification_\0_sections`)`$all_get_always_required_field_names_specifications`=`$all_get_always_required_field_names_specifications`+`'\0,\1`'`}\
`{`(`!`?`$specification_\0_sections`)`$all_get_transient_replacement_field_names_specifications`=`$all_get_transient_replacement_field_names_specifications`+`'\0,\1`'`}\
`]`}
`{`}
// Copyright (c) `{`$year_created`}
//
// CIYAM Pty. Ltd.
// ACN 093 704 539
//
// ALL RIGHTS RESERVED
//
// Permission to use this software for non-commercial purposes is hereby granted. Permission to
// distribute this software privately is granted provided that the source code is unaltered and
// complete or that any alterations and omissions have been first approved by CIYAM. Commercial
// usage of this software is not permitted without first obtaining a license for such a purpose
// from CIYAM. This software may not be publicly distributed unless written permission to do so
// has been obtained from CIYAM.

#ifdef __BORLANDC__
#  include "precompile.h"
#endif
#pragma hdrstop

#ifndef HAS_PRECOMPILED_STD_HEADERS
#  include <cstring>
#  include <fstream>
#  include <iostream>
#  include <algorithm>
#  include <stdexcept>
#endif

#define CIYAM_BASE_LIB
#define MODULE_`{`@upper`(`$module_name`)`}_IMPL

// [<start macros>]
`{`(`?`$user_source`)`#$user_source section=macros`}
// [<finish macros>]

#include "`{`$full_class_name`}.h"
`{`?`$related_types`[`$related_types`,
#include "\$.h"\
`]`}
`{`?`$customised_types`[`$customised_types`,
#include "\$_helper.h"\
`]`}

#include "ciyam_base.h"
#include "class_domains.h"
#include "module_strings.h"
#include "class_utilities.h"
#include "command_handler.h"
#include "module_interface.h"

`{`?`$all_includes_specifications`[`$all_includes_specifications`%,`,\
`{`@eq`(`'\1`'`,`'copy_child_links_from_fk`'`)\
`{`#copy_child_links_from_fk.spec.xrep section=includes module_name=$module_name arg_fkcclass=$specification_\0_fkcclass`}
`,\
`@eq`(`'\1`'`,`'clone_children_for_create`'`)\
`{`#clone_children_for_create.spec.xrep section=includes module_name=$module_name\
 arg_class=$specification_\0_class arg_cclass=$specification_\0_cclass arg_gclass=$specification_\0_gclass`}
`,\
`@eq`(`'\1`'`,`'for_auto_code_user`'`)\
`{`#for_auto_code_user.spec.xrep section=includes module_name=$module_name arg_auto_class=$specification_\0_auto_class`}
`,\
`@eq`(`'\1`'`,`'meta_relationship_field`'`)\
`{`#meta_relationship_field.spec.xrep section=includes module_name=$module_name\
 arg_fclass=$specification_\0_fclass arg_gclass=$specification_\0_gclass`}
`,\
`@eq`(`'\1`'`,`'trigger_copy_fk_children_below_other_fk`'`)\
`{`#trigger_copy_fk_children_below_other_fk.spec.xrep section=includes module_name=$module_name\
 arg_src_fk_key_class=$specification_\0_src_fk_key_class arg_scclass=$specification_\0_scclass arg_dcclass=$specification_\0_dcclass`}
### includes
`}`]`}
// [<start includes>]
`{`(`?`$user_source`)`#$user_source section=includes`}
// [<finish includes>]

using namespace std;

// [<start namespaces>]
`{`(`?`$user_source`)`#$user_source section=namespaces`}
// [<finish namespaces>]
`{`?`$parent_types`[`$parent_types`,
template< > inline string to_string( const \$& c )
{
   return ::to_string( static_cast< const class_base& >( c ) );
}\
`+\n`]`}
`{`?`$parent_types`[`$parent_types`,
inline void from_string( \$& c, const string& s )
{
   ::from_string( static_cast< class_base& >( c ), s );
}\
`+\n`]`}

inline int system( const string& cmd ) { return exec_system( cmd ); }

namespace
{

#include "`{`$full_class_name`}.cmh"

const int32_t c_version = `{`$class_version`};

const char* const c_okay = "okay";
`{`?`$base_fields`[`$base_fields`%,`,
const char* const c_field_id_\0 = "\1";\
`]`}
`{`?`$all_fields`[`$all_fields`%,`,
const char* const c_field_id_\0 = "\2";\
`]`}
`{`?`$base_fields`[`$base_fields`%,`,
const char* const c_field_name_\0 = "\0";\
`]`}
`{`?`$all_fields`[`$all_fields`%,`,
const char* const c_field_name_\0 = "\0";\
`]`}
`{`?`$base_fields`[`$base_fields`%,`,
const char* const c_field_display_name_\0 = "field_`{`@lower`(`'\2`'`)`}_`{`@lower`(`'\0`'`)`}";\
`]`}
`{`?`$all_fields`[`$all_fields`%,`,
const char* const c_field_display_name_\0 = "field_`{`@lower`(`$class_name`)`}_`{`@lower`(`'\0`'`)`}";\
`]`}
`{`!`(`?`$all_fields`)
const int c_num_fields = 0;`,
const int c_num_fields = `{`@count`(`$all_fields`)`};`}
`{`?`$all_sorted_field_ids`[`$all_sorted_field_ids`'
const char* const c_all_sorted_field_ids[ ] =
{`'
   "\$"\
`+,`]
};`}
`{`?`$all_sorted_field_names`[`$all_sorted_field_names`'
const char* const c_all_sorted_field_names[ ] =
{`'
   "\$"\
`+,`]
};`}
`{`(`?`$all_sorted_field_ids`)
inline bool compare( const char* p_s1, const char* p_s2 ) { return strcmp( p_s1, p_s2 ) < 0; }

inline bool has_field( const string& field )
{
   return binary_search( c_all_sorted_field_ids, c_all_sorted_field_ids + c_num_fields, field.c_str( ), compare )
    || binary_search( c_all_sorted_field_names, c_all_sorted_field_names + c_num_fields, field.c_str( ), compare );
}\
`,
bool has_field( const string& ) { static bool false_value( false ); return false_value; }\
`}
`{`!`(`?`$transient_fields`)
const int c_num_transient_fields = 0;`,
const int c_num_transient_fields = `{`@count`(`$transient_fields`)`};`}
`{`?`$transient_sorted_field_ids`[`$transient_sorted_field_ids`'
const char* const c_transient_sorted_field_ids[ ] =
{`'
   "\$"\
`+,`]
};`}
`{`?`$transient_sorted_field_names`[`$transient_sorted_field_names`'
const char* const c_transient_sorted_field_names[ ] =
{`'
   "\$"\
`+,`]
};`}
`{`(`?`$transient_fields`)
inline bool transient_compare( const char* p_s1, const char* p_s2 ) { return strcmp( p_s1, p_s2 ) < 0; }

inline bool is_transient_field( const string& field )
{
   return binary_search( c_transient_sorted_field_ids,
    c_transient_sorted_field_ids + c_num_transient_fields, field.c_str( ), transient_compare )
    || binary_search( c_transient_sorted_field_names,
    c_transient_sorted_field_names + c_num_transient_fields, field.c_str( ), transient_compare );
}\
`,
bool is_transient_field( const string& ) { static bool false_value( false ); return false_value; }\
`}
`{`?`$all_procedure_info`[`$all_procedure_info`%,`,
const char* const c_procedure_id_\1 = "\0";\
`]`}
`{`?`$all_modifiers`[`$all_modifiers`%,`,
const uint64_t c_modifier_\0 = UINT64_C( 0x\1 );\
`]`}
`{`(`?`$fixed_key`)
const string c_fixed_key_value( "`{`$fixed_key`}" );\
`}
`{`?`$domain_fields`[`$domain_fields`,
`{`$domain_type_\$`} g_\$_domain;\
`]`}

string g_order_field_name`{`(`?`$order_field`)( "`{`$order_field`}" )`};

set< string > g_derivations;

set< string > g_file_field_names;

typedef map< string, `{`$full_class_name`}* > external_aliases_container;
typedef external_aliases_container::const_iterator external_aliases_const_iterator;
typedef external_aliases_container::value_type external_aliases_value_type;

typedef map< size_t, `{`$full_class_name`}* > external_aliases_lookup_container;
typedef external_aliases_lookup_container::const_iterator external_aliases_lookup_const_iterator;

external_aliases_container g_external_aliases;
external_aliases_lookup_container g_external_aliases_lookup;

`{`?`$all_fields`[`$all_fields`%,`,\
`{`?`$standard_fields`&`@in`(`'\0`'`,`$standard_fields`)\
\1 gv_default_\0 = \1(`{`(`?`$field_default_\0`) `{`$field_default_\0`}`} );
`,`?`$parent_fields`&`@in`(`'\0`'`,`$parent_fields`)\
string gv_default_\0 = string( );
`}`]`}
`{`(`?`$all_enums`)`[`$all_enums`%,`,\
set< \1 > g_\0_enum;
`]`}
`{`(`?`$all_enums`)`[`$all_enums`%,`,\
`{`[`$enum_\0`%=`,const \1 c_enum_\0_\\1( `{`@eq`(`'\2`'`,`'numlit`'`)\\0`,"\\0"`} );`+\n`]`}

string get_enum_string_\0( \1 val )
{
   string string_name;

   if( to_string( val ) == "" )
      throw runtime_error( "unexpected empty enum value for \0" );
`{`[`$enum_\0`%=`,\
   else if( to_string( val ) == to_string( "\\0" ) )
      string_name = "enum_\0_\\1";\
`+\n`]`}
   else
      throw runtime_error( "unexpected enum value '" + to_string( val ) + "' for \0" );

   return get_module_string( lower( string_name ) );
}
`+\n`]`}
`{`?`$all_anonymous_specifications`[`$all_anonymous_specifications`%,`,\
`{`@eq`(`'\1`'`,`'dummy`'`)\
`{`#dummy.spec.xrep section=anonymous module_name=$module_name class_name=$class_name`}
### anonymous
`}`]`}
// [<start anonymous>]
`{`(`?`$user_source`)`#$user_source section=anonymous`}
// [<finish anonymous>]

}

registration< `{`$full_class_name`} > `{`$class_name`}_registration( get_class_registry( ), "`{`$class_id`}" );

class `{`$full_class_name`}_command_functor;

`{`[`$full_class_name`,\
class \$_command_handler : public command_handler
{
   friend class \$_command_functor;

   public:
   \$_command_handler( ) : p_\$( 0 ) { }

   void set_\$( \$* p_new_\$ ) { p_\$ = p_new_\$; }

   void handle_unknown_command( const string& command )
   {
`{`(`?`$parent_class`)\
      ( void )command;

      retval = p_\$->`{`$parent_class`}::execute( get_cmd_and_args( ) );\
`,\
      throw runtime_error( "unknown command '" + command + "'" );\
`}
   }

   void handle_invalid_command( const command_parser& parser, const string& cmd_and_args )
   {
      throw runtime_error( "invalid command usage '" + cmd_and_args + "'" );
   }

   private:
   \$* p_\$;

   protected:
   string retval;
`{`(`?`$parent_class`)\
   string cmd_and_args;
`}\
};`]`}

class `{`$full_class_name`}_command_functor : public command_functor
{
   public:
   `{`$full_class_name`}_command_functor( `{`$full_class_name`}_command_handler& handler )
    : command_functor( handler ),
    cmd_handler( handler )
   {
   }

   void operator ( )( const string& command, const parameter_info& parameters );

   private:
   `{`$full_class_name`}_command_handler& cmd_handler;
};

command_functor* `{`$full_class_name`}_command_functor_factory( const string& /*name*/, command_handler& handler )
{
   return new `{`$full_class_name`}_command_functor( dynamic_cast< `{`$full_class_name`}_command_handler& >( handler ) );
}

void `{`$full_class_name`}_command_functor::operator ( )( const string& command, const parameter_info& parameters )
{
   if( command == c_cmd_`{`$full_class_name`}_key )
   {
      bool want_fixed( has_parm_val( parameters, c_cmd_parm_`{`$full_class_name`}_key_fixed ) );

      if( !want_fixed )
         cmd_handler.retval = cmd_handler.p_`{`$full_class_name`}->get_key( );
      else
         cmd_handler.retval = cmd_handler.p_`{`$full_class_name`}->get_fixed_key( );
   }
   else if( command == c_cmd_`{`$full_class_name`}_ver )
   {
      string ver_rev( to_string( cmd_handler.p_`{`$full_class_name`}->get_version( ) ) );
      ver_rev += "." + to_string( cmd_handler.p_`{`$full_class_name`}->get_revision( ) );

      cmd_handler.retval = ver_rev;
   }
   else if( command == c_cmd_`{`$full_class_name`}_get )
   {
      string field_name( get_parm_val( parameters, c_cmd_parm_`{`$full_class_name`}_get_field_name ) );

      if( field_name.empty( ) )
         throw runtime_error( "field name must not be empty for getter call" );
`{`?`$all_fields`[`$all_fields`%,`,\
      else if( field_name == c_field_id_\0 || field_name == c_field_name_\0 )
         string_getter< \1 >( cmd_handler.p_`{`$full_class_name`}->\0( ), cmd_handler.retval );\
`+\n`]`}
      else
`{`(`?`$parent_class`)\
         cmd_handler.retval = cmd_handler.p_`{`$full_class_name`}->`{`$parent_class`}::execute( cmd_handler.cmd_and_args );\
`,\
         throw runtime_error( "unknown field name '" + field_name + "' for getter call" );\
`}
   }
   else if( command == c_cmd_`{`$full_class_name`}_set )
   {
      string field_name( get_parm_val( parameters, c_cmd_parm_`{`$full_class_name`}_set_field_name ) );
      string field_value( get_parm_val( parameters, c_cmd_parm_`{`$full_class_name`}_set_field_value ) );

      if( field_name.empty( ) )
         throw runtime_error( "field name must not be empty for setter call" );
`{`?`$all_fields`[`$all_fields`%,`,\
      else if( field_name == c_field_id_\0 || field_name == c_field_name_\0 )
         func_string_setter< `{`$full_class_name`}, \1 >(
          *cmd_handler.p_`{`$full_class_name`}, &`{`$full_class_name`}::\0, field_value );\
`+\n`]`}
      else
`{`(`?`$parent_class`)\
         cmd_handler.p_`{`$full_class_name`}->`{`$parent_class`}::execute( cmd_handler.cmd_and_args );\
`,\
         throw runtime_error( "unknown field name '" + field_name + "' for setter call" );\
`}

      cmd_handler.retval = c_okay;
   }
   else if( command == c_cmd_`{`$full_class_name`}_cmd )
   {
      string field_name( get_parm_val( parameters, c_cmd_parm_`{`$full_class_name`}_cmd_field_name ) );
      string cmd_and_args( get_parm_val( parameters, c_cmd_parm_`{`$full_class_name`}_cmd_cmd_and_args ) );

      cmd_handler.retval.erase( );

      if( field_name.empty( ) )
         throw runtime_error( "field name must not be empty for command call" );
`{`?`$commandable_fields`[`$commandable_fields`%,`,\
      else if( field_name == c_field_id_\0 || field_name == c_field_name_\0 )
      {
         \1 \0( cmd_handler.p_`{`$full_class_name`}->\0( ) );
         execute_command( \0, cmd_and_args, cmd_handler.retval );
         cmd_handler.p_`{`$full_class_name`}->\0( \0 );
      }\
`+\n`]`}
`{`[`$parent_fields`,\
      else if( field_name == c_field_id_\$ || field_name == c_field_name_\$ )
         cmd_handler.retval = cmd_handler.p_`{`$full_class_name`}->\$( ).execute( cmd_and_args );\
`+\n`]`}
      else
`{`(`?`$parent_class`)\
         cmd_handler.retval = cmd_handler.p_`{`$full_class_name`}->`{`$parent_class`}::execute( cmd_handler.cmd_and_args );\
`,\
         throw runtime_error( "unknown field name '" + field_name + "' for command call" );\
`}
   }
`{`?`$all_procedures`[`$all_procedures`,\
   else if( command == c_cmd_`{`$full_class_name`}_\$ )
   {
`{`?`$\$_all_inputs`[`$\$_all_inputs`%,`,\
      \\1 \\0( get_parm_val_from_string< \\1 >( parameters, c_cmd_parm_`{`$full_class_name`}_\$_\\0 ) );
`]`}\
`{`?`$\$_all_outputs`[`$\$_all_outputs`%,`,\
      \\1 \\0;
`]`}\
      cmd_handler.p_`{`$full_class_name`}->\$(`{`?`$\$_all_args`[`$\$_all_args`%,`' `'\\0`+, `]`} );

      cmd_handler.retval.erase( );
`{`?`$\$_all_outputs`[`$\$_all_outputs`%,`,\
      append_value( cmd_handler.retval, \\0 );
`+\\n`]`}\
   }\
`+\n`]`}
}

`{`[`$full_class_name`,\
struct \$::impl : public \$_command_handler
{
   impl( \$& o )`]`}
    :
    cp_obj( &o ),
    total_child_relationships( 0 )
   {
      p_obj = &o;
      set_`{`$full_class_name`}( &o );

      add_commands( 0, `{`$full_class_name`}_command_functor_factory,
       ARRAY_PTR_AND_SIZE( `{`$full_class_name`}_command_definitions ) );
   }

   `{`$full_class_name`}& get_obj( ) const
   {
      return *cp_obj;
   }
`{`?`$all_fields`[`$all_fields`%,`,\
`{`?`$basic_fields`&`@in`(`'\0`'`,`$basic_fields`)\

   \1 impl_\0( ) const { return lazy_fetch( p_obj ), v_\0; }
   void impl_\0( \1 \0 ) { v_\0 = \0; }
`}\
`{`?`$complex_fields`&`@in`(`'\0`'`,`$complex_fields`)\

   const \1& impl_\0( ) const { return lazy_fetch( p_obj ), v_\0; }
   void impl_\0( const \1& \0 ) { v_\0 = \0; }
`}\
`]`}`{`?`$all_fields`[`$all_fields`%,`,\
`{`@in`(`'\0`'`,`$parent_fields`)\

   \1& impl_\0( )
   {
      if( !cp_\0 )
      {
         cp_\0.init( );

         p_obj->setup_graph_parent( *cp_\0, c_field_id_\0, v_\0 );
      }
      return *cp_\0;
   }

   const \1& impl_\0( ) const
   {
      lazy_fetch( p_obj );

      if( !cp_\0 )
      {
         cp_\0.init( );

         p_obj->setup_graph_parent( *cp_\0, c_field_id_\0, v_\0 );
      }
      return *cp_\0;
   }

   void impl_\0( const string& key )
   {
      class_base_accessor cba( impl_\0( ) );
      cba.set_key( key );
   }
`}`]`}`{`?`$child_info`[`$child_info`%,`,\

   \1& impl_\0( )
   {
      if( !cp_\0 )
      {
         cp_\0.init( );

         p_obj->setup_graph_parent( *cp_\0, "\3" );
      }
      return *cp_\0;
   }

   const \1& impl_\0( ) const
   {
      if( !cp_\0 )
      {
         cp_\0.init( );

         p_obj->setup_graph_parent( *cp_\0, "\3" );
      }
      return *cp_\0;
   }
`]`}
`{`?`$all_procedures`[`$all_procedures`,\
   void impl_\$(`{`?`$\$_all_args`[`$\$_all_args`%,`' `'\
`{`@in`(`'\\0`'`,`$\$_all_simple_inputs`)\\1 \\0`}\
`{`@in`(`'\\0`'`,`$\$_all_complex_inputs`)const \\1& \\0`}\
`{`@in`(`'\\0`'`,`$\$_all_non_inputs`)\\1& \\0`}\
`+, `] `});
`+\n`]`}
   string get_field_value( int field ) const;
   void set_field_value( int field, const string& value );

   uint64_t get_state( ) const;

   const string& execute( const string& cmd_and_args );

   void clear_foreign_key( const string& field );

   void set_foreign_key_value( const string& field, const string& value );

   const string& get_foreign_key_value( const string& field );

   void get_foreign_key_values( foreign_key_data_container& foreign_key_values ) const;

   void add_extra_fixed_info( vector< pair< string, string > >& fixed_info ) const;
   void add_extra_paging_info( vector< pair< string, string > >& paging_info ) const;

   void clear( );

   bool value_will_be_provided( const string& field_name );

   void validate( unsigned state, bool is_internal, validation_error_container* p_validation_errors );
   void validate_set_fields( set< string >& fields_set, validation_error_container* p_validation_errors );

   void after_fetch( );
   void finalise_fetch( );

   void at_create( );
   void post_init( );

   void to_store( bool is_create, bool is_internal );
   void for_store( bool is_create, bool is_internal );
   void after_store( bool is_create, bool is_internal );

   bool can_destroy( bool is_internal );
   void for_destroy( bool is_internal );
   void after_destroy( bool is_internal );

   void set_default_values( );

   bool is_filtered( ) const;

   void get_required_transients( ) const;

`{`(`?`$use_transform`)
   void transform( read_stream& rs, int32_t version );
`}
   `{`$full_class_name`}* p_obj;
   class_pointer< `{`$full_class_name`} > cp_obj;

   mutable set< string > required_transients;

   // [<start members>]
`{`(`?`$user_source`)`#$user_source section=members`}
   // [<finish members>]

   size_t total_child_relationships;
`{`?`$standard_fields`}
`{`?`$all_fields`[`$all_fields`%,`,\
`{`?`$standard_fields`&`@in`(`'\0`'`,`$standard_fields`)\
   \1 v_\0;
`}\
`]`}`{`?`$all_fields`[`$all_fields`%,`,\
`{`@in`(`'\0`'`,`$parent_fields`)
   string v_\0;
   mutable class_pointer< \1 > cp_\0;
`}\
`]`}`{`?`$child_info`[`$child_info`%,`'\n`'\
   mutable class_pointer< \1 > cp_\0;
`]`}};

`{`?`$all_procedures`[`$all_procedures`,\
void `{`$full_class_name`}::impl::impl_\$(`{`?`$\$_all_args`[`$\$_all_args`%,`,\
`{`@in`(`'\\0`'`,`$\$_all_simple_inputs`) \\1 \\0`}\
`{`@in`(`'\\0`'`,`$\$_all_complex_inputs`) const \\1& \\0`}\
`{`@in`(`'\\0`'`,`$\$_all_non_inputs`) \\1& \\0`}\
`+,`] `})
{`{`?`$all_procedure_specifications`[`$all_procedure_specifications`%,`,\
`{`@eq`(`'\\1`'`,`'interest`'`)`&`@eq`(`'\$`'`,`$specification_\\0_calc_procedure`)
`{`#interest.spec.xrep section=calculate class_name=$class_name\
 arg_rate=$specification_\\0_rate arg_balance=$specification_\\0_balance\
 arg_calc_start=$specification_\\0_calc_start arg_calc_finish=$specification_\\0_calc_finish`}\
`,\
`@eq`(`'\\1`'`,`'field_inc_in_proc`'`)`&`@eq`(`'\$`'`,`$specification_\\0_proc`)
`{`#field_inc_in_proc.spec.xrep section=proc class_name=$class_name full_class_name=$full_class_name\
 arg_field=$specification_\\0_field arg_value=$specification_\\0_value`}\
`,\
`@eq`(`'\\1`'`,`'for_auto_code`'`)`&`@eq`(`'\$`'`,`$specification_\\0_inc_proc`)
`{`#for_auto_code.spec.xrep section=inc_procedure\
 arg_inc_value=$specification_\\0_inc_value arg_mask_field=$specification_\\0_mask_field\
 arg_next_field=$specification_\\0_next_field arg_exhausted_field=$specification_\\0_exhausted_field`}\
`,\
`@eq`(`'\\1`'`,`'for_call_procs`'`)`&`@eq`(`'\$`'`,`$specification_\\0_procedure`)
`{`#for_call_procs.spec.xrep section=procedure module_name=$module_name class_name=$class_name\
 arg_output_arg=$specification_\\0_output_arg arg_procedure=$specification_\\0_procedure\
 arg_procedure1=$specification_\\0_procedure1 arg_procedure2=$specification_\\0_procedure2\
 arg_no_trans=$specification_\\0_no_trans arg_message=$specification_\\0_message arg_id=$specification_\\0_id`}\
`,\
`@eq`(`'\\1`'`,`'for_clone`'`)`&`@eq`(`'\$`'`,`$specification_\\0_procedure`)
`{`#for_clone.spec.xrep section=procedure module_name=$module_name class_name=$class_name full_class_name=$full_class_name\
 arg_field=$specification_\\0_field arg_value=$specification_\\0_value\
 arg_sfield=$specification_\\0_sfield arg_svalue=$specification_\\0_svalue arg_spfield=$specification_\\0_spfield\
 arg_scfield=$specification_\\0_scfield arg_proc_arg=$specification_\\0_proc_arg arg_tfield=$specification_\\0_tfield\
 arg_procedure=$specification_\\0_procedure arg_use_proc_name=$specification_\\0_use_proc_name\
 arg_key_suffix=$specification_\\0_key_suffix arg_no_trans=$specification_\\0_no_trans\
 arg_clone_only=$specification_\\0_clone_only arg_proc_arg_is_key_suffix=$specification_\\0_proc_arg_is_key_suffix\
 arg_spclass=$specification_\\0_spclass arg_use_proc_arg_for_source=$specification_\\0_use_proc_arg_for_source`}\
`,\
`@eq`(`'\\1`'`,`'for_destroy`'`)`&`@eq`(`'\$`'`,`$specification_\\0_procedure`)
`{`#for_destroy.spec.xrep section=procedure module_name=$module_name class_name=$class_name`}\
`,\
`@eq`(`'\\1`'`,`'for_destroy_clone`'`)`&`@eq`(`'\$`'`,`$specification_\\0_procedure`)
`{`#for_destroy_clone.spec.xrep section=procedure module_name=$module_name class_name=$class_name full_class_name=$full_class_name\
 arg_field=$specification_\\0_field arg_sfield=$specification_\\0_sfield arg_key_suffix=$specification_\\0_key_suffix\
 arg_procedure=$specification_\\0_procedure arg_output_arg=$specification_\\0_output_arg`}\
`,\
`@eq`(`'\\1`'`,`'for_move_children`'`)`&`@eq`(`'\$`'`,`$specification_\\0_procedure`)
`{`#for_move_children.spec.xrep section=procedure module_name=$module_name class_name=$class_name full_class_name=$full_class_name\
 arg_children=$specification_\\0_children arg_cpfield=$specification_\\0_cpfield arg_key_suffix=$specification_\\0_key_suffix\
 arg_move_from=$specification_\\0_move_from`}\
`,\
`@eq`(`'\\1`'`,`'field_from_op`'`)`&`@eq`(`'\$`'`,`$specification_\\0_procedure`)
`{`#field_from_op.spec.xrep section=procedure class_name=$class_name module_name=$module_name\
 arg_field=$specification_\\0_field arg_sfield=$specification_\\0_sfield arg_spfield=$specification_\\0_spfield\
 arg_tfield=$specification_\\0_tfield arg_value=$specification_\\0_value arg_ofield=$specification_\\0_ofield\
 arg_sfistexttype=$specification_\\0_sfistexttype arg_scfistexttype=$specification_\\0_scfistexttype\
 arg_op=$specification_\\0_op arg_type=$specification_\\0_type arg_check=$specification_\\0_check\
 arg_tfistexttype=$specification_\\0_tfistexttype arg_update=$specification_\\0_update`}\
`,\
`@eq`(`'\\1`'`,`'field_from_other_field`'`)`&`@eq`(`'\$`'`,`$specification_\\0_procedure`)
`{`#field_from_other_field.spec.xrep section=procedure class_name=$class_name module_name=$module_name\
 arg_sfield=$specification_\\0_sfield arg_pfield=$specification_\\0_pfield arg_dfield=$specification_\\0_dfield\
 arg_tfield=$specification_\\0_tfield arg_tpfield=$specification_\\0_tpfield arg_tvalue=$specification_\\0_tvalue\
 arg_chk_null=$specification_\\0_chk_null arg_func=$specification_\\0_func arg_create_only=$specification_\\0_create_only\
 arg_mfunc=$specification_\\0_mfunc arg_nvalue=$specification_\\0_nvalue arg_update=$specification_\\0_update\
 arg_tfistexttype=$specification_\\0_tfistexttype arg_tcfistexttype=$specification_\\0_tcfistexttype\
 arg_internal_only=$specification_\\0_internal_only arg_include_clones=$specification_\\0_include_clones`}\
`,\
`@eq`(`'\\1`'`,`'field_from_script`'`)`&`@eq`(`'\$`'`,`$specification_\\0_procedure`)
`{`#field_from_script.spec.xrep section=procedure class_name=$class_name module_name=$module_name\
 arg_field=$specification_\\0_field arg_value=$specification_\\0_value\
 arg_procedure=$specification_\\0_procedure arg_arg1=$specification_\\0_arg1\
 arg_arg2=$specification_\\0_arg2 arg_tfield=$specification_\\0_tfield arg_tvalue=$specification_\\0_tvalue\
 arg_sfield=$specification_\\0_sfield`}\
`,\
`@eq`(`'\\1`'`,`'field_from_unary_op`'`)`&`@eq`(`'\$`'`,`$specification_\\0_procedure`)
`{`#field_from_unary_op.spec.xrep section=procedure class_name=$class_name module_name=$module_name\
 arg_field=$specification_\\0_field arg_sfield=$specification_\\0_sfield arg_tfield=$specification_\\0_tfield\
 arg_op=$specification_\\0_op arg_update=$specification_\\0_update`}\
`,\
`@eq`(`'\\1`'`,`'field_swap_fk`'`)`&`@eq`(`'\$`'`,`$specification_\\0_procedure`)
`{`#field_swap_fk.spec.xrep section=procedure class_name=$class_name module_name=$module_name\
 arg_fk_1=$specification_\\0_fk_1 arg_fk_2=$specification_\\0_fk_2 arg_ofield=$specification_\\0_ofield\
 arg_o2field=$specification_\\0_o2field arg_tfield=$specification_\\0_tfield arg_update=$specification_\\0_update\
 arg_create_only=$specification_\\0_create_only`}\
`,\
`@eq`(`'\\1`'`,`'field_to_value`'`)`&`@eq`(`'\$`'`,`$specification_\\0_procedure`)
`{`#field_to_value.spec.xrep section=procedure class_name=$class_name module_name=$module_name\
 arg_field=$specification_\\0_field arg_fistexttype=$specification_\\0_fistexttype\
 arg_tfield=$specification_\\0_tfield arg_value=$specification_\\0_value arg_evalue=$specification_\\0_evalue\
 arg_update=$specification_\\0_update arg_create_only=$specification_\\0_create_only\
 arg_update_only=$specification_\\0_update_only arg_internal_only=$specification_\\0_internal_only`}\
`,\
`@eq`(`'\\1`'`,`'for_each`'`)`&`@eq`(`'\$`'`,`$specification_\\0_procedure`)
`{`#for_each.spec.xrep section=procedure module_name=$module_name class_name=$class_name\
 arg_field=$specification_\\0_field arg_separator=$specification_\\0_separator\
 arg_oprocedure=$specification_\\0_oprocedure arg_no_trans=$specification_\\0_no_trans`}\
`,\
`@eq`(`'\\1`'`,`'key_generator`'`)`&`@eq`(`'\$`'`,`$specification_\\0_procedure`)
`{`#key_generator.spec.xrep section=procedure class_name=$class_name\
 arg_field=$specification_\\0_field arg_procedure_arg=$specification_\\0_procedure_arg`}\
`,\
`@eq`(`'\\1`'`,`'loop_do_while`'`)`&`@eq`(`'\$`'`,`$specification_\\0_procedure`)
`{`#loop_do_while.spec.xrep section=procedure module_name=$module_name class_name=$class_name\
 arg_field=$specification_\\0_field arg_oprocedure=$specification_\\0_oprocedure`}\
`,\
`@eq`(`'\\1`'`,`'loop_for_int`'`)`&`@eq`(`'\$`'`,`$specification_\\0_procedure`)
`{`#loop_for_int.spec.xrep section=procedure module_name=$module_name class_name=$class_name\
 arg_field=$specification_\\0_field arg_oprocedure=$specification_\\0_oprocedure`}\
`,\
`@eq`(`'\\1`'`,`'loop_while_do`'`)`&`@eq`(`'\$`'`,`$specification_\\0_procedure`)
`{`#loop_while_do.spec.xrep section=procedure module_name=$module_name class_name=$class_name\
 arg_field=$specification_\\0_field arg_oprocedure=$specification_\\0_oprocedure`}\
`,\
`@eq`(`'\\1`'`,`'meta_trait_val_proc`'`)`&`@eq`(`'\$`'`,`$specification_\\0_procedure`)
`{`#meta_trait_val_proc.spec.xrep section=procedure class_name=$class_name\
 arg_field=$specification_\\0_field arg_procedure=$specification_\\0_procedure\
 arg_primitive_arg=$specification_\\0_primitive_arg arg_class_arg=$specification_\\0_class_arg\
 arg_parent_arg=$specification_\\0_parent_arg arg_error_arg=$specification_\\0_error_arg\
 arg_test_value_arg=$specification_\\0_test_value_arg\
 arg_proc_arg_class_arg=$specification_\\0_proc_arg_class_arg\
 arg_proc_arg_type_arg=$specification_\\0_proc_arg_type_arg`}\
`,\
`@eq`(`'\\1`'`,`'move_up_and_down`'`)`&`@eq`(`'\$`'`,`$specification_\\0_up_proc`)
`{`#move_up_and_down.spec.xrep section=up_procedure\
 class_name=$class_name module_name=$module_name arg_field=$specification_\\0_field\
 arg_up_fields=$specification_\\0_up_fields arg_up_values=$specification_\\0_up_values\
 arg_minimal=$specification_\\0_minimal arg_update_parent=$specification_\\0_update_parent`}\
`,\
`@eq`(`'\\1`'`,`'move_up_and_down`'`)`&`@eq`(`'\$`'`,`$specification_\\0_dn_proc`)
`{`#move_up_and_down.spec.xrep section=down_procedure\
 class_name=$class_name module_name=$module_name arg_field=$specification_\\0_field\
 arg_dn_fields=$specification_\\0_dn_fields arg_dn_values=$specification_\\0_dn_values\
 arg_minimal=$specification_\\0_minimal arg_update_parent=$specification_\\0_update_parent`}\
### procedure
`}`]`}
   // [<start \$_impl>]
`{`(`?`$user_source`)`#$user_source section=\$_impl`}\
   // [<finish \$_impl>]
}
`+\n`]`}
string `{`$full_class_name`}::impl::get_field_value( int field ) const
{
   string retval;

   switch( field )
   {
`{`?`$all_fields`[`$all_fields`%,`,\
      case \#:
      retval = to_string( impl_\0( ) );
      break;
`+\n`]`}
      default:
      throw runtime_error( "field #" + to_string( field ) + " is out of range" );
   }

   return retval;
}

void `{`$full_class_name`}::impl::set_field_value( int field, const string& value )
{
   switch( field )
   {
`{`?`$all_fields`[`$all_fields`%,`,\
      case \#:
      func_string_setter< `{`$full_class_name`}::impl, \1 >( *this, &`{`$full_class_name`}::impl::impl_\0, value );
      break;
`+\n`]`}
      default:
      throw runtime_error( "field #" + to_string( field ) + " is out of range" );
   }
}

uint64_t `{`$full_class_name`}::impl::get_state( ) const
{
   uint64_t state = 0;
`{`?`$all_get_state_specifications`[`$all_get_state_specifications`%,`,\
`{`@eq`(`'\1`'`,`'folder`'`)
`{`#folder.spec.xrep section=get_state name=\0`}\
`,\
`@eq`(`'\1`'`,`'modifier_date_notification`'`)
`{`#modifier_date_notification.spec.xrep section=get_state\
 arg_field=$specification_\0_field arg_modifier=$specification_\0_modifier\
 arg_period=$specification_\0_period arg_type=$specification_\0_type arg_annual=$specification_\0_annual`}\
`,\
`@eq`(`'\1`'`,`'modifier_field_compare`'`)
`{`#modifier_field_compare.spec.xrep section=get_state\
 arg_field=$specification_\0_field arg_modifier=$specification_\0_modifier\
 arg_op=$specification_\0_op arg_sfield=$specification_\0_sfield arg_pfield=$specification_\0_pfield\
 arg_tfield=$specification_\0_tfield arg_tpfield=$specification_\0_tpfield`}\
`,\
`@eq`(`'\1`'`,`'modifier_field_null`'`)
`{`#modifier_field_null.spec.xrep section=get_state\
 arg_field=$specification_\0_field arg_pfield=$specification_\0_pfield arg_modifier=$specification_\0_modifier\
 arg_is_neg=$specification_\0_is_neg arg_not_dflt=$specification_\0_not_dflt\
 arg_tfield=$specification_\0_tfield arg_tpfield=$specification_\0_tpfield arg_tvalue=$specification_\0_tvalue`}\
`,\
`@eq`(`'\1`'`,`'modifier_field_value`'`)
`{`#modifier_field_value.spec.xrep section=get_state\
 arg_field=$specification_\0_field\
 arg_pfield=$specification_\0_pfield\
 arg_tfield=$specification_\0_tfield\
 arg_tpfield=$specification_\0_tpfield\
 arg_tvalue=$specification_\0_tvalue\
 arg_value=$specification_\0_value\
 arg_evalue=$specification_\0_evalue\
 arg_testop=$specification_\0_testop\
 arg_modifier=$specification_\0_modifier\
 arg_not_eq=$specification_\0_not_eq\
 arg_not_dflt=$specification_\0_not_dflt\
 arg_cvt_func=$specification_\0_cvt_func\
 arg_fistexttype=$specification_\0_fistexttype`}\
`,\
`@eq`(`'\1`'`,`'modifier_from_not_other_mod`'`)
`{`#modifier_from_not_other_mod.spec.xrep section=get_state\
 arg_modifier=$specification_\0_modifier arg_omodifier=$specification_\0_omodifier`}\
`,\
`@eq`(`'\1`'`,`'modifier_from_other_mods`'`)
`{`#modifier_from_other_mods.spec.xrep section=get_state\
 arg_op=$specification_\0_op arg_modifier=$specification_\0_modifier\
 arg_lmodifier=$specification_\0_lmodifier arg_rmodifier=$specification_\0_rmodifier`}\
`,\
`@eq`(`'\1`'`,`'modifier_key_value`'`)
`{`#modifier_key_value.spec.xrep section=get_state\
 arg_modifier=$specification_\0_modifier arg_value=$specification_\0_value\
 arg_extra=$specification_\0_extra arg_not_eq=$specification_\0_not_eq`}\
`,\
`@eq`(`'\1`'`,`'modifier_past_date_time`'`)
`{`#modifier_past_date_time.spec.xrep section=get_state\
 arg_dfield=$specification_\0_dfield\
 arg_dfprim=$specification_\0_dfprim\
 arg_tfield=$specification_\0_tfield\
 arg_tvalue=$specification_\0_tvalue\
 arg_value=$specification_\0_value\
 arg_future=$specification_\0_future\
 arg_modifier=$specification_\0_modifier`}\
`,\
`@eq`(`'\1`'`,`'modifier_permission`'`)
`{`#modifier_permission.spec.xrep section=get_state\
 arg_modifier=$specification_\0_modifier arg_permission=$specification_\0_permission\
 arg_permission_id=$specification_\0_permission_id arg_ufield=$specification_\0_ufield\
 arg_admin_always=$specification_\0_admin_always arg_remove=$specification_\0_remove`}\
`,\
`@eq`(`'\1`'`,`'permit_ignore_uneditable`'`)
`{`#permit_ignore_uneditable.spec.xrep section=get_state\
 arg_tfield=$specification_\0_tfield arg_admin_always=$specification_\0_admin_always`}\
`,\
`@eq`(`'\1`'`,`'permit_user_ignore_uneditable`'`)
`{`#permit_user_ignore_uneditable.spec.xrep section=get_state module_name=$module_name class_name=$class_name\
 arg_spclass=$specification_\0_spclass arg_scfield=$specification_\0_scfield\
 arg_tfield=$specification_\0_tfield arg_tpfield=$specification_\0_tpfield\
 arg_op=$specification_\0_op arg_vname=$specification_\0_vname arg_otfield=$specification_\0_otfield`}\
`,\
`@eq`(`'\1`'`,`'protect_equal`'`)
`{`#protect_equal.spec.xrep section=get_state\
 arg_field=$specification_\0_field arg_pfield=$specification_\0_pfield arg_label=$specification_\0_label\
 arg_value=$specification_\0_value arg_scope=$specification_\0_scope arg_changing=$specification_\0_changing\
 arg_admin_always=$specification_\0_admin_always arg_scripts_always=$specification_\0_scripts_always`}\
`,\
`@eq`(`'\1`'`,`'protect_not_equal`'`)
`{`#protect_not_equal.spec.xrep section=get_state\
 arg_field=$specification_\0_field arg_pfield=$specification_\0_pfield arg_label=$specification_\0_label\
 arg_value=$specification_\0_value arg_scope=$specification_\0_scope arg_changing=$specification_\0_changing\
 arg_admin_always=$specification_\0_admin_always arg_scripts_always=$specification_\0_scripts_always`}\
`,\
`@eq`(`'\1`'`,`'restrict_protect`'`)
`{`#restrict_protect.spec.xrep section=get_state\
 arg_field=$specification_\0_field arg_pfield=$specification_\0_pfield arg_tfield=$specification_\0_tfield\
 arg_permission=$specification_\0_permission arg_permission_id=$specification_\0_permission_id\
 arg_scope=$specification_\0_scope arg_changing=$specification_\0_changing\
 arg_admin_always=$specification_\0_admin_always arg_no_ignore=$specification_\0_no_ignore\
 arg_unactionable=$specification_\0_unactionable`}\
`,\
`@eq`(`'\1`'`,`'restrict_uid_not_equal`'`)
`{`#restrict_uid_not_equal.spec.xrep section=get_state\
 arg_admin_always=$specification_\0_admin_always arg_perm=$specification_\0_perm arg_perm_id=$specification_\0_perm_id\
 arg_sfield=$specification_\0_sfield arg_scfield=$specification_\0_scfield arg_scope=$specification_\0_scope\
 arg_tfield=$specification_\0_tfield arg_ufield=$specification_\0_ufield arg_unactionable=$specification_\0_unactionable`}\
`,\
`@eq`(`'\1`'`,`'state_protect`'`)`{`;NOTE: This can be removed when modeller.exe is no longer used.`}
`{`#$specification_\0_spec_file section=get_state name=\0\
 arg_field=$specification_\0_field arg_pfield=$specification_\0_pfield arg_label=$specification_\0_label\
 arg_value=$specification_\0_spec_value arg_scope=$specification_\0_spec_scope arg_changing=$specification_\0_changing\
 arg_admin_always=$specification_\0_admin_always arg_scripts_always=$specification_\0_scripts_always`}\
`,\
`@eq`(`'\1`'`,`'unactionable_field_value`'`)
`{`#unactionable_field_value.spec.xrep section=get_state\
 arg_field=$specification_\0_field arg_pfield=$specification_\0_pfield\
 arg_value=$specification_\0_value arg_evalue=$specification_\0_evalue\
 arg_not_eq=$specification_\0_not_eq arg_fistexttype=$specification_\0_fistexttype`}\
### get_state
`}`]`}

   // [<start get_state>]
`{`(`?`$user_source`)`#$user_source section=get_state`}
   // [<finish get_state>]

   return state;
}

const string& `{`$full_class_name`}::impl::execute( const string& cmd_and_args )
{
`{`(`?`$parent_class`)\
   this->cmd_and_args = cmd_and_args;\
`}
   execute_command( cmd_and_args );
   return retval;
}

void `{`$full_class_name`}::impl::clear_foreign_key( const string& field )
{
   if( field.empty( ) )
      throw runtime_error( "unexpected empty field name/id" );
`{`[`$parent_fields`,\
   else if( field == c_field_id_\$ || field == c_field_name_\$ )
      impl_\$( "" );\
`+\n`]`}
`{`(`?`$parent_class`)\
   else
      p_obj->parent_class_type::clear_foreign_key( field );\
`,\
   else
      throw runtime_error( "unknown foreign key field '" + field + "'" );\
`}
}

void `{`$full_class_name`}::impl::set_foreign_key_value( const string& field, const string& value )
{
   if( field.empty( ) )
      throw runtime_error( "unexpected empty field name/id for value: " + value );
`{`[`$parent_fields`,\
   else if( field == c_field_id_\$ || field == c_field_name_\$ )
      v_\$ = value;\
`+\n`]`}
`{`(`?`$parent_class`)\
   else
      p_obj->parent_class_type::set_foreign_key_value( field, value );\
`,\
   else
      throw runtime_error( "unknown foreign key field '" + field + "'" );\
`}
}

const string& `{`$full_class_name`}::impl::get_foreign_key_value( const string& field )
{
   if( field.empty( ) )
      throw runtime_error( "unexpected empty field name/id" );
`{`[`$parent_fields`,\
   else if( field == c_field_id_\0 || field == c_field_name_\0 )
      return v_\0;\
`+\n`]`}
`{`(`?`$parent_class`)\
   else
      return p_obj->parent_class_type::get_foreign_key_value( field );\
`,\
   else
      throw runtime_error( "unknown foreign key field '" + field + "'" );\
`}
}

void `{`$full_class_name`}::impl::get_foreign_key_values( foreign_key_data_container& foreign_key_values ) const
{
`{`@eq`(`$parent_fields`,`'`'`)\
   ( void )foreign_key_values;\
`}
`{`[`$parent_fields`,\
   foreign_key_values.insert( foreign_key_data_value_type( c_field_id_\0, v_\0 ) );\
`+\n`]`}
}

void `{`$full_class_name`}::impl::add_extra_fixed_info( vector< pair< string, string > >& fixed_info ) const
{
   ( void )fixed_info;
`{`?`$all_add_extra_fixed_info_specifications`[`$all_add_extra_fixed_info_specifications`%,`,\
`{`@eq`(`'\1`'`,`'dummy`'`)
`{`#dummy.spec.xrep section=add_extra_fixed_info module_name=$module_name`}\
### add_extra_fixed_info
`}`]`}

   // [<start add_extra_fixed_info>]
`{`(`?`$user_source`)`#$user_source section=add_extra_fixed_info`}
   // [<finish add_extra_fixed_info>]
}

void `{`$full_class_name`}::impl::add_extra_paging_info( vector< pair< string, string > >& paging_info ) const
{
   ( void )paging_info;
`{`?`$all_add_extra_paging_info_specifications`[`$all_add_extra_paging_info_specifications`%,`,\
`{`@eq`(`'\1`'`,`'restrict_paging`'`)
`{`#restrict_paging.spec.xrep section=add_extra_paging_info module_name=$module_name\
 arg_page_field=$specification_\0_page_field arg_tfield=$specification_\0_tfield arg_variable=$specification_\0_variable`}\
### add_extra_paging_info
`}`]`}

   // [<start add_extra_paging_info>]
`{`(`?`$user_source`)`#$user_source section=add_extra_paging_info`}
   // [<finish add_extra_paging_info>]
}

void `{`$full_class_name`}::impl::clear( )
{`{`?`$all_fields`[`$all_fields`%,`,\
`{`?`$standard_fields`&`@in`(`'\0`'`,`$standard_fields`)
   v_\0 = gv_default_\0;\
`}`]`}
`{`?`$parent_fields`[`$parent_fields`,
   v_\$ = string( );
   if( cp_\$ )
      p_obj->setup_foreign_key( *cp_\$, v_\$ );\
`+\n`]`}
}

bool `{`$full_class_name`}::impl::value_will_be_provided( const string& field_name )
{
   ( void )field_name;
`{`?`$all_value_will_be_provided_specifications`[`$all_value_will_be_provided_specifications`%,`,\
`{`@eq`(`'\1`'`,`'audit_fields`'`)
`{`#audit_fields.spec.xrep section=value_will_be_provided module_name=$module_name\
 arg_cusrfield=$specification_\0_cusrfield arg_cdtmfield=$specification_\0_cdtmfield\
 arg_musrfield=$specification_\0_musrfield arg_mdtmfield=$specification_\0_mdtmfield`}\
`,\
`@eq`(`'\1`'`,`'default_from_key`'`)`&`@eq`(`$specification_\0_fmandatory`,`'1`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#default_from_key.spec.xrep section=value_will_be_provided class_name=$class_name arg_field=$specification_\0_field`}\
`,\
`@eq`(`'\1`'`,`'default_to_dtm`'`)`&`@eq`(`$specification_\0_fmandatory`,`'1`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#default_to_dtm.spec.xrep section=value_will_be_provided class_name=$class_name arg_field=$specification_\0_field`}\
`,\
`@eq`(`'\1`'`,`'default_to_field`'`)`&`@eq`(`$specification_\0_fmandatory`,`'1`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#default_to_field.spec.xrep section=value_will_be_provided class_name=$class_name arg_field=$specification_\0_field`}\
`,\
`@eq`(`'\1`'`,`'default_to_uid`'`)`&`@eq`(`$specification_\0_fmandatory`,`'1`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#default_to_uid.spec.xrep section=value_will_be_provided class_name=$class_name arg_field=$specification_\0_field`}\
`,\
`@eq`(`'\1`'`,`'field_from_changed_fk`'`)`&`@eq`(`$specification_\0_fmandatory`,`'1`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#field_from_changed_fk.spec.xrep section=value_will_be_provided class_name=$class_name arg_dfield=$specification_\0_dfield`}\
`,\
`@eq`(`'\1`'`,`'field_from_dtm`'`)`&`@eq`(`$specification_\0_fmandatory`,`'1`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#field_from_dtm.spec.xrep section=value_will_be_provided class_name=$class_name arg_field=$specification_\0_field`}\
`,\
`@eq`(`'\1`'`,`'field_from_module_string`'`)`&`@eq`(`$specification_\0_fmandatory`,`'1`'`)
`{`#field_from_module_string.spec.xrep section=value_will_be_provided class_name=$class_name arg_field=$specification_\0_field`}\
`,\
`@eq`(`'\1`'`,`'field_from_other_field`'`)`&`@eq`(`$specification_\0_fmandatory`,`'1`'`)\
`&`@eq`(`$specification_\0_for_store`,`'true`'`)`&`@eq`(`$specification_\0_procedure`,`'`'`)
`{`#field_from_other_field.spec.xrep section=value_will_be_provided class_name=$class_name\
 arg_dfield=$specification_\0_dfield`}\
`,\
`@eq`(`'\1`'`,`'field_from_uid`'`)`&`@eq`(`$specification_\0_fmandatory`,`'1`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#field_from_uid.spec.xrep section=value_will_be_provided class_name=$class_name arg_field=$specification_\0_field`}\
`,\
`@eq`(`'\1`'`,`'field_to_value`'`)`&`@eq`(`$specification_\0_fmandatory`,`'1`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#field_to_value.spec.xrep section=value_will_be_provided class_name=$class_name arg_field=$specification_\0_field`}\
`,\
`@eq`(`'\1`'`,`'fk_link_first_child`'`)`&`@eq`(`$specification_\0_fmandatory`,`'1`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#fk_link_first_child.spec.xrep section=value_will_be_provided class_name=$class_name arg_field=$specification_\0_field`}\
`,\
`@eq`(`'\1`'`,`'for_auto_code_user`'`)`&`@eq`(`$specification_\0_fmandatory`,`'1`'`)
`{`#for_auto_code_user.spec.xrep section=value_will_be_provided module_name=$module_name arg_field=$specification_\0_field`}\
`,\
`@eq`(`'\1`'`,`'parent_auto_int_inc`'`)`&`@eq`(`$specification_\0_fmandatory`,`'1`'`)
`{`#parent_auto_int_inc.spec.xrep section=value_will_be_provided module_name=$module_name\
 arg_field=$specification_\0_field`}\
### value_will_be_provided
`}`]`}

   // [<start value_will_be_provided>]
`{`(`?`$user_source`)`#$user_source section=value_will_be_provided`}
   // [<finish value_will_be_provided>]

   return false;
}

void `{`$full_class_name`}::impl::validate( unsigned state, bool is_internal, validation_error_container* p_validation_errors )
{
   ( void )state;
   ( void )is_internal;

   if( !p_validation_errors )
      throw runtime_error( "unexpected null validation_errors container" );
`{`?`$mandatory_normal_fields`[`$mandatory_normal_fields`,
   if( is_null( v_\$ ) && !value_will_be_provided( c_field_name_\$ ) )
      p_validation_errors->insert( validation_error_value_type( c_field_name_\$,
       get_string_message( GS( c_str_field_must_not_be_empty ), make_pair(
       c_str_parm_field_must_not_be_empty_field, get_module_string( c_field_display_name_\$ ) ) ) ) );\
`+\n`]`}
`{`?`$mandatory_parent_fields`[`$mandatory_parent_fields`,
   if( v_\$.empty( ) && !value_will_be_provided( c_field_name_\$ ) )
      p_validation_errors->insert( validation_error_value_type( c_field_name_\$,
       get_string_message( GS( c_str_field_must_not_be_empty ), make_pair(
       c_str_parm_field_must_not_be_empty_field, get_module_string( c_field_display_name_\$ ) ) ) ) );\
`+\n`]`}
`{`(`?`$domain_fields`)
   string error_message;\
`}
`{`?`$domain_fields`[`$domain_fields`,\
   if( !is_null( v_\$ )
    && ( v_\$ != gv_default_\$
    || !value_will_be_provided( c_field_name_\$ ) )
    && !g_\$_domain.is_valid( v_\$, error_message = "`{`(`?`$domain_mask_\$`)`$domain_mask_\$`}" ) )
      p_validation_errors->insert( validation_error_value_type( c_field_name_\$,
       get_module_string( c_field_display_name_\$ ) + " " + error_message ) );\
`+\n\n`]`}
`{`?`$enum_fields`[`$enum_fields`%,`,
   if( !g_\1_enum.count( v_\0 ) )
      p_validation_errors->insert( validation_error_value_type( c_field_name_\0,
       get_string_message( GS( c_str_field_has_invalid_value ), make_pair(
       c_str_parm_field_has_invalid_value_field, get_module_string( c_field_display_name_\0 ) ) ) ) );\
`+\n`]`}
`{`?`$all_validate_specifications`[`$all_validate_specifications`%,`,\
`{`@eq`(`'\1`'`,`'acyclic`'`)
`{`#acyclic.spec.xrep section=validate class_name=$class_name full_class_name=$full_class_name arg_field=$specification_\0_field`}\
`,\
`@eq`(`'\1`'`,`'check_children_not_active`'`)
`{`#check_children_not_active.spec.xrep section=validate class_name=$class_name module_name=$module_name\
 arg_tfield=$specification_\0_tfield arg_child=$specification_\0_child\
 arg_cclass=$specification_\0_cclass arg_cfield=$specification_\0_cfield`}\
`,\
`@eq`(`'\1`'`,`'check_compare_op_field`'`)
`{`#check_compare_op_field.spec.xrep section=validate class_name=$class_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield\
 arg_spfield=$specification_\0_spfield arg_op=$specification_\0_op arg_tfield=$specification_\0_tfield\
 arg_not_null=$specification_\0_not_null arg_not_pedit=$specification_\0_not_pedit`}\
`,\
`@eq`(`'\1`'`,`'check_compare_op_value`'`)
`{`#check_compare_op_value.spec.xrep section=validate class_name=$class_name module_name=$module_name\
 arg_sfield=$specification_\0_sfield arg_spfield=$specification_\0_spfield arg_spclass=$specification_\0_spclass\
 arg_sfistexttype=$specification_\0_sfistexttype arg_scfistexttype=$specification_\0_scfistexttype\
 arg_value=$specification_\0_value arg_tfield=$specification_\0_tfield arg_op=$specification_\0_op`}\
`,\
`@eq`(`'\1`'`,`'check_cond_non_null`'`)
`{`#check_cond_non_null.spec.xrep section=validate class_name=$class_name\
 arg_field=$specification_\0_field arg_cfield=$specification_\0_cfield arg_pfield=$specification_\0_pfield\
 arg_tfield=$specification_\0_tfield arg_tpfield=$specification_\0_tpfield arg_tvalue=$specification_\0_tvalue\
 arg_is_neg=$specification_\0_is_neg arg_test_neq=$specification_\0_test_neq`}\
`,\
`@eq`(`'\1`'`,`'check_dep_field_changed`'`)
`{`#check_dep_field_changed.spec.xrep section=validate class_name=$class_name\
 arg_field=$specification_\0_field arg_tfield=$specification_\0_tfield`}\
`,\
`@eq`(`'\1`'`,`'check_field_op_field`'`)
`{`#check_field_op_field.spec.xrep section=validate class_name=$class_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield arg_spfield=$specification_\0_spfield\
 arg_op=$specification_\0_op arg_tfield=$specification_\0_tfield`}\
`,\
`@eq`(`'\1`'`,`'check_parent_fk_match`'`)
`{`#check_parent_fk_match.spec.xrep section=validate class_name=$class_name\
 arg_field=$specification_\0_field arg_pfield=$specification_\0_pfield\
 arg_cfield=$specification_\0_cfield arg_tfield=$specification_\0_tfield\
 arg_check_if_unchanged=$specification_\0_check_if_unchanged`}\
`,\
`@eq`(`'\1`'`,`'check_no_repeats`'`)
`{`#check_no_repeats.spec.xrep section=validate class_name=$class_name\
 arg_field_list=$specification_\0_field_list arg_skip_nulls=$specification_\0_skip_nulls`}\
`,\
`@eq`(`'\1`'`,`'check_null_match`'`)
`{`#check_null_match.spec.xrep section=validate class_name=$class_name\
 arg_field1=$specification_\0_field1 arg_field2=$specification_\0_field2`}\
`,\
`@eq`(`'\1`'`,`'folder`'`)
`{`#folder.spec.xrep section=validate class_name=$class_name arg_field=$specification_\0_field`}\
`,\
`@eq`(`'\1`'`,`'for_auto_code`'`)
`{`#for_auto_code.spec.xrep section=validate\
 arg_mask_field=$specification_\0_mask_field arg_next_field=$specification_\0_next_field`}\
`,\
`@eq`(`'\1`'`,`'meta_spec_field_type`'`)
`{`#meta_spec_field_type.spec.xrep section=validate class_name=$class_name\
 arg_mclass=$specification_\0_mclass arg_fclass=$specification_\0_fclass\
 arg_field=$specification_\0_field arg_cfield=$specification_\0_cfield\
 arg_mfield=$specification_\0_mfield arg_pfield=$specification_\0_pfield\
 arg_mpfield=$specification_\0_mpfield arg_mcrfield=$specification_\0_mcrfield\
 arg_mcrcfield=$specification_\0_mcrcfield arg_crmfield=$specification_\0_crmfield\
 arg_crpmfield=$specification_\0_crpmfield arg_crgpmfield=$specification_\0_crgpmfield\
 arg_prfield=$specification_\0_prfield arg_tvfield=$specification_\0_tvfield\
 arg_tpfield=$specification_\0_tpfield arg_tcfield=$specification_\0_tcfield\
 arg_sfield=$specification_\0_sfield arg_mtsfield=$specification_\0_mtsfield\
 arg_tfield=$specification_\0_tfield arg_mttfield=$specification_\0_mttfield\
 arg_spfield=$specification_\0_spfield arg_scfield=$specification_\0_scfield\
 arg_sftfield=$specification_\0_sftfield arg_efield=$specification_\0_efield\
 arg_procedure=$specification_\0_procedure arg_pafield=$specification_\0_pafield\
 arg_patfield=$specification_\0_patfield arg_pacfield=$specification_\0_pacfield\
 arg_uikey=$specification_\0_uikey arg_pwname=$specification_\0_pwname arg_pwname2=$specification_\0_pwname2\
 arg_pwvalue=$specification_\0_pwvalue arg_pwvalue2=$specification_\0_pwvalue2\
 arg_ugname=$specification_\0_ugname arg_ugvalue=$specification_\0_ugvalue`}\
`,\
`@eq`(`'\1`'`,`'modifier_field_required`'`)
`{`#modifier_field_required.spec.xrep section=validate class_name=$class_name\
 arg_field=$specification_\0_field arg_modifier=$specification_\0_modifier`}\
### validate
`}`]`}

   // [<start validate>]
`{`(`?`$user_source`)`#$user_source section=validate`}
   // [<finish validate>]
}

void `{`$full_class_name`}::impl::validate_set_fields( set< string >& fields_set, validation_error_container* p_validation_errors )
{
   ( void )fields_set;

   if( !p_validation_errors )
      throw runtime_error( "unexpected null validation_errors container" );
`{`(`?`$domain_fields`)
   string error_message;\
`}
`{`?`$domain_fields`[`$domain_fields`,
   if( !is_null( v_\$ )
    && ( fields_set.count( c_field_id_\$ ) || fields_set.count( c_field_name_\$ ) )
    && !g_\$_domain.is_valid( v_\$, error_message = "`{`(`?`$domain_mask_\$`)`$domain_mask_\$`}" ) )
      p_validation_errors->insert( validation_error_value_type( c_field_name_\$,
       get_module_string( c_field_display_name_\$ ) + " " + error_message ) );\
`+\n`]`}
}

void `{`$full_class_name`}::impl::after_fetch( )
{
   if( !get_obj( ).get_is_iterating( ) || get_obj( ).get_is_starting_iteration( ) )
      get_required_transients( );
`{`[`$parent_fields`,
   if( cp_\$ )
      p_obj->setup_foreign_key( *cp_\$, v_\$ );\
`+\n`]`}

   post_init( );

   uint64_t state = p_obj->get_state( );
   ( void )state;
`{`?`$all_after_fetch_specifications`[`$all_after_fetch_specifications`%,`,\
`{`@eq`(`'\1`'`,`'append_opts_for_iter`'`)
`{`#append_opts_for_iter.spec.xrep section=after_fetch class_name=$class_name module_name=$module_name\
 arg_cclass=$specification_\0_cclass arg_child=$specification_\0_child arg_field=$specification_\0_field\
 arg_ofield=$specification_\0_ofield arg_cfield=$specification_\0_cfield arg_separator=$specification_\0_separator\
 arg_embed_links=$specification_\0_embed_links`}\
`,\
`@eq`(`'\1`'`,`'default_for_clone`'`)
`{`#default_for_clone.spec.xrep section=after_fetch class_name=$class_name arg_field=$specification_\0_field`}\
`,\
`@eq`(`'\1`'`,`'default_to_label`'`)`&`@eq`(`$specification_\0_ftransient`,`'1`'`)
`{`#default_to_label.spec.xrep section=after_fetch class_name=$class_name\
 arg_field=$specification_\0_field arg_label_str=$specification_\0_label_str`}\
`,\
`@eq`(`'\1`'`,`'field_from_acyclic_path`'`)`&`@eq`(`$specification_\0_ftransient`,`'1`'`)
`{`#field_from_acyclic_path.spec.xrep section=after_fetch_or_for_store full_class_name=$full_class_name\
 arg_pfield=$specification_\0_pfield arg_src_field=$specification_\0_src_field\
 arg_dest_field=$specification_\0_dest_field arg_separator=$specification_\0_separator\
 arg_embed_links=$specification_\0_embed_links arg_external=$specification_\0_external\
 arg_ftransient=specification_\0_ftransient arg_ext_field=$specification_\0_ext_field`}\
`,\
`@eq`(`'\1`'`,`'field_from_search_replace`'`)`&`@eq`(`$specification_\0_ftransient`,`'1`'`)
`{`#field_from_search_replace.spec.xrep section=after_fetch class_name=$class_name module_name=$module_name\
 arg_dfield=$specification_\0_dfield arg_sfield=$specification_\0_sfield\
 arg_cfield=$specification_\0_cfield arg_field_list=$specification_\0_field_list\
 arg_keyrep=$specification_\0_keyrep arg_separator=$specification_\0_separator arg_opt_prefix=$specification_\0_opt_prefix\
 arg_ofield=$specification_\0_ofield arg_oleftb=$specification_\0_oleftb arg_orightb=$specification_\0_orightb\
 arg_top_level=$specification_\0_top_level arg_inc_labels=$specification_\0_inc_labels arg_classrep=$specification_\0_classrep`}\
`,\
`@eq`(`'\1`'`,`'meta_relationship_child_name`'`)
`{`#meta_relationship_child_name.spec.xrep section=after_fetch full_class_name=$full_class_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield\
 arg_pfield1=$specification_\0_pfield1 arg_pfield2=$specification_\0_pfield2\
 arg_pcfield1=$specification_\0_pcfield1 arg_pcfield2=$specification_\0_pcfield2`}\
`,\
`@eq`(`'\1`'`,`'transient_add_action_child_create_for_uid`'`)
`{`#transient_add_action_child_create_for_uid.spec.xrep section=after_fetch\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield\
 arg_child=$specification_\0_child arg_procedure=$specification_\0_procedure\
 arg_permission=$specification_\0_permission arg_permission_id=$specification_\0_permission_id\
 arg_tfield=$specification_\0_tfield arg_not_self=$specification_\0_not_self\
 arg_top_level=$specification_\0_top_level arg_not_iterating=$specification_\0_not_iterating`}\
`,\
`@eq`(`'\1`'`,`'transient_event_overlap`'`)
`{`#transient_event_overlap.spec.xrep section=after_fetch full_class_name=$full_class_name\
 arg_class=$specification_\0_class arg_user=$specification_\0_user arg_group=$specification_\0_group\
 arg_field=$specification_\0_field arg_when=$specification_\0_when arg_duration=$specification_\0_duration\
 arg_finish=$specification_\0_finish`}\
`,\
`@eq`(`'\1`'`,`'transient_field_action`'`)
`{`#transient_field_action.spec.xrep section=after_fetch class_name=$class_name\
 arg_actions=$specification_\0_actions arg_procedure=$specification_\0_procedure\
 arg_ofield=$specification_\0_ofield arg_vfield=$specification_\0_vfield\
 arg_ufield=$specification_\0_ufield arg_tfield=$specification_\0_tfield\
 arg_prompt=$specification_\0_prompt arg_back_for_view=$specification_\0_back_for_view\
 arg_admin_always=$specification_\0_admin_always arg_permission=$specification_\0_permission\
 arg_permission_id=$specification_\0_permission_id arg_altfield=$specification_\0_altfield\
 arg_check_not_in_set=$specification_\0_check_not_in_set arg_vname=$specification_\0_vname\
 arg_iterating=$specification_\0_iterating arg_not_iterating=$specification_\0_not_iterating\
 arg_edit_record=$specification_\0_edit_record arg_clone_record=$specification_\0_clone_record\
 arg_state=$specification_\0_state arg_admin_never=$specification_\0_admin_never`}\
`,\
`@eq`(`'\1`'`,`'transient_field_action_create_from_fk`'`)
`{`#transient_field_action_create_from_fk.spec.xrep section=after_fetch module_name=$module_name\
 arg_action=$specification_\0_action arg_actions=$specification_\0_actions arg_fkfield=$specification_\0_fkfield\
 arg_key_sep=$specification_\0_key_sep arg_sfield=$specification_\0_sfield arg_spfield=$specification_\0_spfield\
 arg_spclass=$specification_\0_spclass`}\
`,\
`@eq`(`'\1`'`,`'transient_field_action_for_mod`'`)
`{`#transient_field_action_for_mod.spec.xrep section=after_fetch class_name=$class_name\
 arg_actions=$specification_\0_actions arg_procedure=$specification_\0_procedure\
 arg_modifier=$specification_\0_modifier arg_tfield=$specification_\0_tfield\
 arg_prompt=$specification_\0_prompt arg_back_for_view=$specification_\0_back_for_view\
 arg_admin_always=$specification_\0_admin_always arg_admin_never=$specification_\0_admin_never\
 arg_iterating=$specification_\0_iterating arg_not_iterating=$specification_\0_not_iterating\
 arg_edit_record=$specification_\0_edit_record arg_clone_record=$specification_\0_clone_record\
 arg_ofield=$specification_\0_ofield arg_vfield=$specification_\0_vfield`}\
`,\
`@eq`(`'\1`'`,`'transient_field_alias`'`)
`{`#transient_field_alias.spec.xrep section=after_fetch class_name=$class_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield\
 arg_func=$specification_\0_func arg_mfunc=$specification_\0_mfunc\
 arg_scfield=$specification_\0_scfield arg_def_value=$specification_\0_def_value\
 arg_iter_only=$specification_\0_iter_only arg_check_mod=$specification_\0_check_mod`}\
`,\
`@eq`(`'\1`'`,`'transient_field_bool_has_child_for_uid`'`)
`{`#transient_field_bool_has_child_for_uid.spec.xrep section=after_fetch module_name=$module_name\
 arg_field=$specification_\0_field arg_ufield=$specification_\0_ufield arg_permission=$specification_\0_permission\
 arg_permission_id=$specification_\0_permission_id arg_child=$specification_\0_child arg_cclass=$specification_\0_cclass\
 arg_cpfield=$specification_\0_cpfield arg_cufield=$specification_\0_cufield arg_not_self=$specification_\0_not_self\
 arg_top_level=$specification_\0_top_level arg_not_iterating=$specification_\0_not_iterating`}\
`,\
`@eq`(`'\1`'`,`'transient_field_bool_uid`'`)
`{`#transient_field_bool_uid.spec.xrep section=after_fetch class_name=$class_name\
 arg_field=$specification_\0_field arg_admin=$specification_\0_admin arg_system=$specification_\0_system`}\
`,\
`@eq`(`'\1`'`,`'transient_field_from_class`'`)
`{`#transient_field_from_class.spec.xrep section=after_fetch class_name=$class_name\
 arg_field=$specification_\0_field`}\
`,\
`@eq`(`'\1`'`,`'transient_field_concat`'`)
`{`#transient_field_concat.spec.xrep section=after_fetch class_name=$class_name\
 arg_dfield=$specification_\0_dfield arg_field1=$specification_\0_field1 arg_field2=$specification_\0_field2\
 arg_field3=$specification_\0_field3 arg_cfield=$specification_\0_cfield arg_separator=$specification_\0_separator\
 arg_rfield=$specification_\0_rfield arg_reverse=$specification_\0_reverse arg_non_empty=$specification_\0_non_empty\
 arg_top_level=$specification_\0_top_level`}\
`,\
`@eq`(`'\1`'`,`'transient_field_from_dtm`'`)
`{`#transient_field_from_dtm.spec.xrep section=after_fetch class_name=$class_name\
 arg_field=$specification_\0_field`}\
`,\
`@eq`(`'\1`'`,`'transient_field_from_file`'`)
`{`#transient_field_from_file.spec.xrep section=after_fetch class_name=$class_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield arg_suffix=$specification_\0_suffix`}\
`,\
`@eq`(`'\1`'`,`'transient_field_from_key`'`)
`{`#transient_field_from_key.spec.xrep section=after_fetch class_name=$class_name\
 arg_field=$specification_\0_field`}\
`,\
`@eq`(`'\1`'`,`'transient_field_from_module_string`'`)
`{`#transient_field_from_module_string.spec.xrep section=after_fetch class_name=$class_name\
 arg_id=$specification_\0_id arg_field=$specification_\0_field arg_tfield=$specification_\0_tfield`}\
`,\
`@eq`(`'\1`'`,`'transient_field_from_op`'`)
`{`#transient_field_from_op.spec.xrep section=after_fetch class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield arg_spfield=$specification_\0_spfield\
 arg_tfield=$specification_\0_tfield arg_value=$specification_\0_value arg_ofield=$specification_\0_ofield\
 arg_sfistexttype=$specification_\0_sfistexttype arg_scfistexttype=$specification_\0_scfistexttype\
 arg_op=$specification_\0_op arg_type=$specification_\0_type arg_check=$specification_\0_check`}\
`,\
`@eq`(`'\1`'`,`'transient_field_from_uid`'`)
`{`#transient_field_from_uid.spec.xrep section=after_fetch class_name=$class_name\
 arg_field=$specification_\0_field`}\
`,\
`@eq`(`'\1`'`,`'transient_field_from_variable`'`)
`{`#transient_field_from_variable.spec.xrep section=after_fetch class_name=$class_name\
 arg_field=$specification_\0_field arg_variable=$specification_\0_variable arg_sfield=$specification_\0_sfield\
 arg_spfield=$specification_\0_spfield`}\
`,\
`@eq`(`'\1`'`,`'transient_field_from_unary_op`'`)
`{`#transient_field_from_unary_op.spec.xrep section=after_fetch class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield arg_tfield=$specification_\0_tfield\
 arg_op=$specification_\0_op`}\
`,\
`@eq`(`'\1`'`,`'transient_field_to_value`'`)
`{`#transient_field_to_value.spec.xrep section=after_fetch class_name=$class_name\
 arg_field=$specification_\0_field arg_fistexttype=$specification_\0_fistexttype arg_value=$specification_\0_value`}\
`,\
`@eq`(`'\1`'`,`'transient_field_value_if_has_perm`'`)
`{`#transient_field_value_if_has_perm.spec.xrep section=after_fetch class_name=$class_name\
 arg_field=$specification_\0_field arg_value=$specification_\0_value arg_permission=$specification_\0_permission\
 arg_permission_id=$specification_\0_permission_id arg_admin_always=$specification_\0_admin_always`}\
`,\
`@eq`(`'\1`'`,`'transient_field_value_if_uid_in_set`'`)
`{`#transient_field_value_if_uid_in_set.spec.xrep section=after_fetch class_name=$class_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield arg_value=$specification_\0_value\
 arg_admin_always=$specification_\0_admin_always`}\
`,\
`@eq`(`'\1`'`,`'transient_fk_field`'`)
`{`#transient_fk_field.spec.xrep section=after_fetch class_name=$class_name\
 arg_dfield=$specification_\0_dfield arg_pfield=$specification_\0_pfield arg_cfield=$specification_\0_cfield`}\
`,\
`@eq`(`'\1`'`,`'transient_has_child`'`)
`{`#transient_has_child.spec.xrep section=after_fetch class_name=$class_name\
 arg_field=$specification_\0_field arg_value=$specification_\0_value arg_child=$specification_\0_child`}\
`,\
`@eq`(`'\1`'`,`'transient_permission_concat`'`)
`{`#transient_permission_concat.spec.xrep section=after_fetch class_name=$class_name\
 arg_field=$specification_\0_field arg_tfield=$specification_\0_tfield\
 arg_tvalue=$specification_\0_tvalue arg_permission=$specification_\0_permission\
 arg_permission_id=$specification_\0_permission_id arg_admin_always=$specification_\0_admin_always`}\
`,\
`@eq`(`'\1`'`,`'transient_permission_from_other_perms`'`)
`{`#transient_permission_from_other_perms.spec.xrep section=after_fetch class_name=$class_name\
 arg_field=$specification_\0_field arg_op=$specification_\0_op arg_permission=$specification_\0_permission\
 arg_permission_id=$specification_\0_permission_id arg_lpermission=$specification_\0_lpermission\
 arg_lpermission_id=$specification_\0_lpermission_id arg_rpermission=$specification_\0_rpermission\
 arg_rpermission_id=$specification_\0_rpermission_id`}\
`,\
`@eq`(`'\1`'`,`'transient_search_rep_from_child_vars`'`)
`{`#transient_search_rep_from_child_vars.spec.xrep section=after_fetch class_name=$class_name\
 arg_field=$specification_\0_field arg_varchild=$specification_\0_varchild arg_varname=$specification_\0_varname\
 arg_varvalue=$specification_\0_varvalue arg_lb=$specification_\0_lb arg_rb=$specification_\0_rb`}\
### after_fetch
`}`]`}

   // [<start after_fetch>]
`{`(`?`$user_source`)`#$user_source section=after_fetch`}
   // [<finish after_fetch>]
`{`(`?`$auto_round_fields`)
`}`{`?`$auto_round_fields`[`$auto_round_fields`%,`,\
   v_\0.round( \1, \2 );\
`+\n`]`}
}

void `{`$full_class_name`}::impl::finalise_fetch( )
{
`{`?`$all_finalise_fetch_specifications`[`$all_finalise_fetch_specifications`%,`,\
`{`@eq`(`'\1`'`,`'field_from_procedure_call`'`)`&`@eq`(`$specification_\0_transient`,`'true`'`)\
`{`#field_from_procedure_call.spec.xrep section=finalise_fetch class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_procedure=$specification_\0_procedure arg_value=$specification_\0_value`}
### finalise_fetch
`}`]`}
   // [<start finalise_fetch>]
`{`(`?`$user_source`)`#$user_source section=finalise_fetch`}
   // [<finish finalise_fetch>]
}

void `{`$full_class_name`}::impl::at_create( )
{
`{`?`$all_at_create_specifications`[`$all_at_create_specifications`%,`,\
`{`@eq`(`'\1`'`,`'default_group_fk_for_user`'`)\
`{`#default_group_fk_for_user.spec.xrep section=at_create class_name=$class_name\
 arg_pfield=$specification_\0_pfield arg_ufield=$specification_\0_ufield arg_gfield=$specification_\0_gfield`}
`,\
`@eq`(`'\1`'`,`'file_attachment`'`)\
`{`#file_attachment.spec.xrep section=at_create arg_field=$specification_\0_field`}
`,\
`@eq`(`'\1`'`,`'fk_default`'`)\
`{`#fk_default.spec.xrep section=at_create arg_field=$specification_\0_field arg_value=$specification_\0_value`}
### at_create
`}`]`}
   // [<start at_create>]
`{`(`?`$user_source`)`#$user_source section=at_create`}
   // [<finish at_create>]
}

void `{`$full_class_name`}::impl::post_init( )
{
`{`?`$all_post_init_specifications`[`$all_post_init_specifications`%,`,\
`{`@eq`(`'\1`'`,`'field_bool_dtm`'`)`&`@eq`(`$specification_\0_post_init`,`'true`'`)\
`{`#field_bool_dtm.spec.xrep section=post_init class_name=$class_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield\
 arg_amount=$specification_\0_amount arg_type=$specification_\0_type arg_older=$specification_\0_older`}
`,\
`@eq`(`'\1`'`,`'field_bool_from_other_enum`'`)`&`@eq`(`$specification_\0_post_init`,`'true`'`)\
`{`#field_bool_from_other_enum.spec.xrep section=post_init class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield\
 arg_value=$specification_\0_value arg_evalue=$specification_\0_evalue\
 arg_sfistexttype=$specification_\0_sfistexttype`}
`,\
`@eq`(`'\1`'`,`'field_bool_is_default`'`)`&`@eq`(`$specification_\0_post_init`,`'true`'`)\
`{`#field_bool_is_default.spec.xrep section=post_init class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield arg_is_neq=$specification_\0_is_neq`}
`,\
`@eq`(`'\1`'`,`'field_bool_uid`'`)`&`@eq`(`$specification_\0_post_init`,`'true`'`)\
`{`#field_bool_uid.spec.xrep section=post_init class_name=$class_name\
 arg_field=$specification_\0_field arg_admin=$specification_\0_admin\
 arg_system=$specification_\0_system arg_not_equal=$specification_\0_not_equal`}
`,\
`@eq`(`'\1`'`,`'field_from_op`'`)`&`@eq`(`$specification_\0_post_init`,`'true`'`)\
`{`#field_from_op.spec.xrep section=post_init class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield arg_spfield=$specification_\0_spfield\
 arg_tfield=$specification_\0_tfield arg_value=$specification_\0_value arg_ofield=$specification_\0_ofield\
 arg_sfistexttype=$specification_\0_sfistexttype arg_scfistexttype=$specification_\0_scfistexttype\
 arg_op=$specification_\0_op arg_type=$specification_\0_type arg_check=$specification_\0_check\
 arg_tfistexttype=$specification_\0_tfistexttype arg_update=$specification_\0_update`}
`,\
`@eq`(`'\1`'`,`'field_from_uid`'`)`&`@eq`(`$specification_\0_post_init`,`'true`'`)\
`{`#field_from_uid.spec.xrep section=post_init class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_tfield=$specification_\0_tfield arg_create_only=$specification_\0_create_only`}
`,\
`@eq`(`'\1`'`,`'field_from_unary_op`'`)`&`@eq`(`$specification_\0_post_init`,`'true`'`)\
`{`#field_from_unary_op.spec.xrep section=post_init class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield arg_tfield=$specification_\0_tfield\
 arg_op=$specification_\0_op arg_update=$specification_\0_update`}
`,\
`@eq`(`'\1`'`,`'field_to_value`'`)`&`@eq`(`$specification_\0_post_init`,`'true`'`)\
`{`#field_to_value.spec.xrep section=post_init class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_fistexttype=$specification_\0_fistexttype\
 arg_tfield=$specification_\0_tfield arg_value=$specification_\0_value arg_evalue=$specification_\0_evalue\
 arg_update=$specification_\0_update arg_create_only=$specification_\0_create_only\
 arg_update_only=$specification_\0_update_only arg_internal_only=$specification_\0_internal_only`}
### post_init
`}`]`}
   // [<start post_init>]
`{`(`?`$user_source`)`#$user_source section=post_init`}
   // [<finish post_init>]
}

void `{`$full_class_name`}::impl::to_store( bool is_create, bool is_internal )
{
   ( void )is_create;
   ( void )is_internal;

   if( !get_obj( ).get_is_preparing( ) )
      post_init( );

   uint64_t state = p_obj->get_state( );
   ( void )state;
`{`?`$all_to_store_specifications`[`$all_to_store_specifications`%,`,\
`{`@eq`(`'\1`'`,`'default_from_key`'`)`&`@eq`(`$specification_\0_for_store`,`'`'`)
`{`#default_from_key.spec.xrep section=to_or_for_store class_name=$class_name\
 arg_field=$specification_\0_field arg_func=$specification_\0_func\
 arg_chk_null=$specification_\0_chk_null arg_not_dflt=$specification_\0_not_dflt arg_append=$specification_\0_append\
 arg_inc_clones=$specification_\0_inc_clones arg_skip_fk_handling=$specification_\0_skip_fk_handling`}\
`,\
`@eq`(`'\1`'`,`'default_to_dtm`'`)`&`@eq`(`$specification_\0_for_store`,`'`'`)
`{`#default_to_dtm.spec.xrep section=to_or_for_store class_name=$class_name arg_field=$specification_\0_field`}\
`,\
`@eq`(`'\1`'`,`'default_to_field`'`)`&`@eq`(`$specification_\0_for_store`,`'`'`)
`{`#default_to_field.spec.xrep section=to_or_for_store class_name=$class_name\
 arg_field=$specification_\0_field arg_pfield=$specification_\0_pfield arg_sfield=$specification_\0_sfield\
 arg_tpfield=$specification_\0_tpfield arg_tfield=$specification_\0_tfield arg_tvalue=$specification_\0_tvalue\
 arg_append=$specification_\0_append arg_not_dflt=$specification_\0_not_dflt arg_cvt_func=$specification_\0_cvt_func\
 arg_fistexttype=$specification_\0_fistexttype arg_inc_clones=$specification_\0_inc_clones`}\
`,\
`@eq`(`'\1`'`,`'default_to_label`'`)`&`@eq`(`$specification_\0_ftransient`,`'0`'`)
`{`#default_to_label.spec.xrep section=to_store class_name=$class_name\
 arg_field=$specification_\0_field arg_label_str=$specification_\0_label_str`}\
`,\
`@eq`(`'\1`'`,`'default_to_uid`'`)`&`@eq`(`$specification_\0_for_store`,`'`'`)
`{`#default_to_uid.spec.xrep section=to_or_for_store class_name=$class_name\
 arg_field=$specification_\0_field arg_force_for_clone=$specification_\0_force_for_clone`}\
`,\
`@eq`(`'\1`'`,`'default_to_global`'`)
`{`#default_to_global.spec.xrep section=to_store\
 arg_field=$specification_\0_field arg_cfield=$specification_\0_cfield\
 arg_dflt_only=$specification_\0_dflt_only arg_inc_exist=$specification_\0_inc_exist arg_value=$specification_\0_value\
 arg_tpfield=$specification_\0_tpfield arg_tfield=$specification_\0_tfield arg_tvalue=$specification_\0_tvalue`}\
`,\
`@eq`(`'\1`'`,`'field_bool_dtm`'`)`&`@eq`(`$specification_\0_for_store`,`'`'`)`&`@eq`(`$specification_\0_post_init`,`'`'`)
`{`#field_bool_dtm.spec.xrep section=to_or_for_store class_name=$class_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield\
 arg_amount=$specification_\0_amount arg_type=$specification_\0_type arg_older=$specification_\0_older`}\
`,\
`@eq`(`'\1`'`,`'field_bool_from_other_enum`'`)`&`@eq`(`$specification_\0_for_store`,`'`'`)`&`@eq`(`$specification_\0_post_init`,`'`'`)
`{`#field_bool_from_other_enum.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield\
 arg_value=$specification_\0_value arg_evalue=$specification_\0_evalue\
 arg_sfistexttype=$specification_\0_sfistexttype`}\
`,\
`@eq`(`'\1`'`,`'field_bool_has_changed`'`)`&`@eq`(`$specification_\0_for_store`,`'`'`)
`{`#field_bool_has_changed.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_value=$specification_\0_value\
 arg_sfield=$specification_\0_sfield arg_sfistexttype=$specification_\0_sfistexttype\
 arg_not_null=$specification_\0_not_null arg_var=$specification_\0_var`}\
`,\
`@eq`(`'\1`'`,`'field_bool_is_default`'`)`&`@eq`(`$specification_\0_for_store`,`'`'`)`&`@eq`(`$specification_\0_post_init`,`'`'`)
`{`#field_bool_is_default.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield arg_is_neq=$specification_\0_is_neq`}\
`,\
`@eq`(`'\1`'`,`'field_bool_uid`'`)`&`@eq`(`$specification_\0_for_store`,`'`'`)`&`@eq`(`$specification_\0_post_init`,`'`'`)
`{`#field_bool_uid.spec.xrep section=to_or_for_store class_name=$class_name\
 arg_field=$specification_\0_field arg_admin=$specification_\0_admin\
 arg_system=$specification_\0_system arg_not_equal=$specification_\0_not_equal`}\
`,\
`@eq`(`'\1`'`,`'field_clear`'`)`&`@eq`(`$specification_\0_for_store`,`'`'`)
`{`#field_clear.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield arg_spfield=$specification_\0_spfield\
 arg_tfield=$specification_\0_tfield arg_fistexttype=$specification_\0_fistexttype arg_is_neg=$specification_\0_is_neg\
 arg_set_to_default=$specification_\0_set_to_default`}\
`,\
`@eq`(`'\1`'`,`'field_clear_on_changed_fk`'`)`&`@eq`(`$specification_\0_for_store`,`'`'`)
`{`#field_clear_on_changed_fk.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_pfield=$specification_\0_pfield arg_field=$specification_\0_field\
 arg_tfield=$specification_\0_tfield arg_tpfield=$specification_\0_tpfield arg_tvalue=$specification_\0_tvalue\
 arg_not_dflt=$specification_\0_not_dflt arg_not_create=$specification_\0_not_create\
 arg_fistexttype=$specification_\0_fistexttype arg_set_to_default=$specification_\0_set_to_default`}\
`,\
`@eq`(`'\1`'`,`'field_empty_action`'`)
`{`#field_empty_action.spec.xrep section=to_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_act_field=$specification_\0_act_field\
 arg_pfield=$specification_\0_pfield arg_nvalue=$specification_\0_nvalue arg_value=$specification_\0_value\
 arg_is_neg=$specification_\0_is_neg arg_create_only=$specification_\0_create_only arg_is_testval=$specification_\0_is_testval`}\
`,\
`@eq`(`'\1`'`,`'field_from_changed_fk`'`)`&`@eq`(`$specification_\0_for_store`,`'`'`)
`{`#field_from_changed_fk.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_pfield=$specification_\0_pfield arg_dfield=$specification_\0_dfield\
 arg_sfield=$specification_\0_sfield arg_new_only=$specification_\0_new_only\
 arg_not_create=$specification_\0_not_create arg_inc_dflt=$specification_\0_inc_dflt\
 arg_not_null=$specification_\0_not_null arg_trigger_only=$specification_\0_trigger_only`}\
`,\
`@eq`(`'\1`'`,`'field_from_child_auto_int_inc`'`)
`{`#field_from_child_auto_int_inc.spec.xrep section=to_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_pfield=$specification_\0_pfield\
 arg_child=$specification_\0_child arg_prefix=$specification_\0_prefix`}\
`,\
`@eq`(`'\1`'`,`'field_from_child_concat`'`)`&`?`$specification_\0_field`&`@eq`(`$specification_\0_for_store`,`'`'`)
`{`#field_from_child_concat.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_cfield=$specification_\0_cfield arg_ofield=$specification_\0_ofield\
 arg_children=$specification_\0_children arg_cclass=$specification_\0_cclass arg_separator=$specification_\0_separator\
 arg_ctransient=$specification_\0_ctransient arg_embed_links=$specification_\0_embed_links\
 arg_tfield=$specification_\0_tfield arg_tvalue=$specification_\0_tvalue arg_tfistexttype=$specification_\0_tfistexttype\
 arg_xpfield=$specification_\0_xpfield arg_xdfield=$specification_\0_xdfield`}\
`,\
`@eq`(`'\1`'`,`'field_from_concatenation`'`)
`{`#field_from_concatenation.spec.xrep section=to_store class_name=$class_name module_name=$module_name\
 arg_dfield=$specification_\0_dfield arg_tfield=$specification_\0_tfield\
 arg_field_list=$specification_\0_field_list arg_separator=$specification_\0_separator`}\
`,\
`@eq`(`'\1`'`,`'field_from_dtm`'`)`&`@eq`(`$specification_\0_for_store`,`'`'`)
`{`#field_from_dtm.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field`}\
`,\
`@eq`(`'\1`'`,`'field_from_module_string`'`)
`{`#field_from_module_string.spec.xrep section=to_store class_name=$class_name\
 arg_id=$specification_\0_id arg_field=$specification_\0_field arg_tfield=$specification_\0_tfield`}\
`,\
`@eq`(`'\1`'`,`'field_from_op`'`)`&`@eq`(`$specification_\0_for_store`,`'`'`)\
`&`@eq`(`$specification_\0_post_init`,`'`'`)`&`@eq`(`$specification_\0_procedure`,`'`'`)
`{`#field_from_op.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield arg_spfield=$specification_\0_spfield\
 arg_tfield=$specification_\0_tfield arg_value=$specification_\0_value arg_ofield=$specification_\0_ofield\
 arg_sfistexttype=$specification_\0_sfistexttype arg_scfistexttype=$specification_\0_scfistexttype\
 arg_op=$specification_\0_op arg_type=$specification_\0_type arg_check=$specification_\0_check\
 arg_tfistexttype=$specification_\0_tfistexttype arg_update=$specification_\0_update`}\
`,\
`@eq`(`'\1`'`,`'field_from_other_field`'`)`&`@eq`(`$specification_\0_for_store`,`'`'`)`&`@eq`(`$specification_\0_procedure`,`'`'`)
`{`#field_from_other_field.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_sfield=$specification_\0_sfield arg_pfield=$specification_\0_pfield arg_dfield=$specification_\0_dfield\
 arg_tfield=$specification_\0_tfield arg_tpfield=$specification_\0_tpfield arg_tvalue=$specification_\0_tvalue\
 arg_chk_null=$specification_\0_chk_null arg_func=$specification_\0_func arg_create_only=$specification_\0_create_only\
 arg_mfunc=$specification_\0_mfunc arg_nvalue=$specification_\0_nvalue arg_update=$specification_\0_update\
 arg_tfistexttype=$specification_\0_tfistexttype arg_tcfistexttype=$specification_\0_tcfistexttype\
 arg_internal_only=$specification_\0_internal_only arg_include_clones=$specification_\0_include_clones`}\
`,\
`@eq`(`'\1`'`,`'field_from_procedure_call`'`)`&`@eq`(`$specification_\0_transient`,`'`'`)
`{`#field_from_procedure_call.spec.xrep section=to_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_procedure=$specification_\0_procedure arg_value=$specification_\0_value`}\
`,\
`@eq`(`'\1`'`,`'field_from_search_replace`'`)`&`@eq`(`$specification_\0_ftransient`,`'0`'`)
`{`#field_from_search_replace.spec.xrep section=to_store class_name=$class_name module_name=$module_name\
 arg_dfield=$specification_\0_dfield arg_sfield=$specification_\0_sfield arg_top_level=$specification_\0_top_level\
 arg_cfield=$specification_\0_cfield arg_field_list=$specification_\0_field_list arg_classrep=$specification_\0_classrep\
 arg_keyrep=$specification_\0_keyrep arg_separator=$specification_\0_separator arg_opt_prefix=$specification_\0_opt_prefix\
 arg_ofield=$specification_\0_ofield arg_oleftb=$specification_\0_oleftb arg_orightb=$specification_\0_orightb`}\
`,\
`@eq`(`'\1`'`,`'field_from_uid`'`)`&`@eq`(`$specification_\0_for_store`,`'`'`)`&`@eq`(`$specification_\0_post_init`,`'`'`)
`{`#field_from_uid.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_tfield=$specification_\0_tfield arg_create_only=$specification_\0_create_only`}\
`,\
`@eq`(`'\1`'`,`'field_from_unary_op`'`)`&`@eq`(`$specification_\0_for_store`,`'`'`)\
`&`@eq`(`$specification_\0_post_init`,`'`'`)`&`@eq`(`$specification_\0_procedure`,`'`'`)
`{`#field_from_unary_op.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield arg_tfield=$specification_\0_tfield\
 arg_op=$specification_\0_op arg_update=$specification_\0_update`}\
`,\
`@eq`(`'\1`'`,`'field_from_updating_graph_parent`'`)`&`@eq`(`$specification_\0_for_store`,`'`'`)
`{`#field_from_updating_graph_parent.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_spclass=$specification_\0_spclass arg_scfield=$specification_\0_scfield\
 arg_tvalue=$specification_\0_tvalue`}\
`,\
`@eq`(`'\1`'`,`'field_quote_cloned_html`'`)
`{`#field_quote_cloned_html.spec.xrep section=to_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield arg_spfield=$specification_\0_spfield\
 arg_tfield=$specification_\0_tfield`}\
`,\
`@eq`(`'\1`'`,`'field_swap_fk`'`)`&`@eq`(`$specification_\0_for_store`,`'`'`)`&`@eq`(`$specification_\0_procedure`,`'`'`)
`{`#field_swap_fk.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_fk_1=$specification_\0_fk_1 arg_fk_2=$specification_\0_fk_2 arg_ofield=$specification_\0_ofield\
 arg_o2field=$specification_\0_o2field arg_tfield=$specification_\0_tfield arg_update=$specification_\0_update\
 arg_create_only=$specification_\0_create_only`}\
`,\
`@eq`(`'\1`'`,`'field_to_rounded`'`)
`{`#field_to_rounded.spec.xrep section=to_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_decimals=$specification_\0_decimals arg_method=$specification_\0_method`}\
`,\
`@eq`(`'\1`'`,`'field_to_value`'`)`&`@eq`(`$specification_\0_for_store`,`'`'`)\
`&`@eq`(`$specification_\0_post_init`,`'`'`)`&`@eq`(`$specification_\0_procedure`,`'`'`)
`{`#field_to_value.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_fistexttype=$specification_\0_fistexttype\
 arg_tfield=$specification_\0_tfield arg_value=$specification_\0_value arg_evalue=$specification_\0_evalue\
 arg_update=$specification_\0_update arg_create_only=$specification_\0_create_only\
 arg_update_only=$specification_\0_update_only arg_internal_only=$specification_\0_internal_only`}\
`,\
`@eq`(`'\1`'`,`'field_to_value_for_updating_graph_parent`'`)`&`@eq`(`$specification_\0_for_store`,`'`'`)
`{`#field_to_value_for_updating_graph_parent.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_spclass=$specification_\0_spclass arg_scfield=$specification_\0_scfield\
 arg_tfield=$specification_\0_tfield arg_value=$specification_\0_value arg_tvalue=$specification_\0_tvalue\
 arg_fistexttype=$specification_\0_fistexttype arg_tfistexttype=$specification_\0_tfistexttype`}\
`,\
`@eq`(`'\1`'`,`'field_value`'`)`&`@eq`(`$specification_\0_for_store`,`'`'`)
`{`#field_value.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_tfield=$specification_\0_tfield arg_tpfield=$specification_\0_tpfield\
 arg_value=$specification_\0_value arg_not_null=$specification_\0_not_null arg_not_create=$specification_\0_not_create`}\
`,\
`@eq`(`'\1`'`,`'field_values_from_graph_parent`'`)
`{`#field_values_from_graph_parent.spec.xrep section=to_store class_name=$class_name module_name=$module_name\
 arg_pclass=$specification_\0_pclass arg_psfield=$specification_\0_psfield arg_field_info=$specification_\0_field_info`}\
`,\
`@eq`(`'\1`'`,`'fk_empty_action`'`)
`{`#fk_empty_action.spec.xrep section=to_store class_name=$class_name module_name=$module_name\
 arg_act_field=$specification_\0_act_field\
 arg_fk_field=$specification_\0_fk_field arg_value=$specification_\0_value`}\
`,\
`@eq`(`'\1`'`,`'fk_link_first_child`'`)`&`@eq`(`$specification_\0_for_store`,`'`'`)
`{`#fk_link_first_child.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_pfield=$specification_\0_pfield arg_fmandatory=$specification_\0_fmandatory\
 arg_child=$specification_\0_child arg_child_class=$specification_\0_child_class arg_child_field=$specification_\0_child_field\
 arg_order_field=$specification_\0_order_field arg_status_field=$specification_\0_status_field\
 arg_status_value=$specification_\0_status_value arg_new_only=$specification_\0_new_only\
 arg_reverse=$specification_\0_reverse arg_not_create=$specification_\0_not_create`}\
`,\
`@eq`(`'\1`'`,`'meta_spec_field_type`'`)
`{`#meta_spec_field_type.spec.xrep section=to_store class_name=$class_name\
 arg_mclass=$specification_\0_mclass arg_fclass=$specification_\0_fclass\
 arg_field=$specification_\0_field arg_cfield=$specification_\0_cfield\
 arg_mfield=$specification_\0_mfield arg_pfield=$specification_\0_pfield\
 arg_tpfield=$specification_\0_tpfield arg_tvfield=$specification_\0_tvfield\
 arg_sfield=$specification_\0_sfield arg_mtsfield=$specification_\0_mtsfield\
 arg_tfield=$specification_\0_tfield arg_mttfield=$specification_\0_mttfield\
 arg_spfield=$specification_\0_spfield arg_scfield=$specification_\0_scfield\
 arg_sftfield=$specification_\0_sftfield arg_efield=$specification_\0_efield\
 arg_procedure=$specification_\0_procedure arg_pafield=$specification_\0_pafield\
 arg_patfield=$specification_\0_patfield arg_pacfield=$specification_\0_pacfield\
 arg_uikey=$specification_\0_uikey arg_pwname=$specification_\0_pwname arg_pwvalue=$specification_\0_pwvalue\
 arg_ugname=$specification_\0_ugname arg_ugvalue=$specification_\0_ugvalue`}\
`,\
`@eq`(`'\1`'`,`'meta_spec_field_pairs`'`)
`{`#meta_spec_field_pairs.spec.xrep section=to_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_ofield=$specification_\0_ofield arg_child=$specification_\0_child\
 arg_sfield=$specification_\0_sfield arg_tvalue=$specification_\0_tvalue`}\
`,\
`@eq`(`'\1`'`,`'meta_spec_field_values`'`)
`{`#meta_spec_field_values.spec.xrep section=to_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_rfield=$specification_\0_rfield arg_ofield=$specification_\0_ofield\
 arg_child=$specification_\0_child arg_sfield=$specification_\0_sfield arg_fkfield=$specification_\0_fkfield arg_tvalue=$specification_\0_tvalue`}\
`,\
`@eq`(`'\1`'`,`'modifier_set_field`'`)
`{`#modifier_set_field.spec.xrep section=to_store class_name=$class_name\
 arg_modifier=$specification_\0_modifier arg_field=$specification_\0_field\
 arg_value=$specification_\0_value arg_evalue=$specification_\0_evalue`}\
### to_store
`}`]`}

   // [<start to_store>]
`{`(`?`$user_source`)`#$user_source section=to_store`}
   // [<finish to_store>]
`{`(`?`$auto_round_fields`)
`}`{`?`$auto_round_fields`[`$auto_round_fields`%,`,\
   v_\0.round( \1, \2 );\
`+\n`]`}
}

void `{`$full_class_name`}::impl::for_store( bool is_create, bool is_internal )
{
   ( void )is_create;
   ( void )is_internal;
`{`?`$all_for_store_specifications`[`$all_for_store_specifications`%,`,\
`{`@eq`(`'\1`'`,`'audit_fields`'`)
`{`#audit_fields.spec.xrep section=for_store class_name=$class_name module_name=$module_name\
 arg_cusrfield=$specification_\0_cusrfield arg_cdtmfield=$specification_\0_cdtmfield\
 arg_musrfield=$specification_\0_musrfield arg_mdtmfield=$specification_\0_mdtmfield`}\
`,\
`@eq`(`'\1`'`,`'child_field_cascade`'`)`&`@eq`(`$specification_\0_after_self`,`'`'`)
`{`#child_field_cascade.spec.xrep section=for_or_after_store class_name=$class_name module_name=$module_name\
 arg_child=$specification_\0_child arg_field_list=$specification_\0_field_list arg_testop=$specification_\0_testop\
 arg_tfield=$specification_\0_tfield arg_ctfield=$specification_\0_ctfield arg_check_orig=$specification_\0_check_orig\
 arg_any_change=$specification_\0_any_change`}\
`,\
`@eq`(`'\1`'`,`'child_field_change_cascade`'`)
`{`#child_field_change_cascade.spec.xrep section=for_store full_class_name=$full_class_name\
 arg_child=$specification_\0_child arg_field=$specification_\0_field\
 arg_cfield=$specification_\0_cfield arg_exact_match=$specification_\0_exact_match`}\
`,\
`@eq`(`'\1`'`,`'child_status_cascade`'`)
`{`#child_status_cascade.spec.xrep section=for_store class_name=$class_name module_name=$module_name\
 arg_status_value=$specification_\0_status_value arg_child=$specification_\0_child\
 arg_child_class=$specification_\0_child_class arg_child_field=$specification_\0_child_field\
 arg_order_field=$specification_\0_order_field arg_special_field=$specification_\0_special_field\
 arg_special_cfield=$specification_\0_special_cfield arg_special_value=$specification_\0_special_value\
 arg_neq_status_field=$specification_\0_neq_status_field arg_neq_status_value=$specification_\0_neq_status_value`}\
`,\
`@eq`(`'\1`'`,`'default_from_key`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#default_from_key.spec.xrep section=to_or_for_store class_name=$class_name\
 arg_field=$specification_\0_field arg_func=$specification_\0_func\
 arg_chk_null=$specification_\0_chk_null arg_not_dflt=$specification_\0_not_dflt arg_append=$specification_\0_append\
 arg_inc_clones=$specification_\0_inc_clones arg_skip_fk_handling=$specification_\0_skip_fk_handling`}\
`,\
`@eq`(`'\1`'`,`'default_to_dtm`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#default_to_dtm.spec.xrep section=to_or_for_store class_name=$class_name arg_field=$specification_\0_field`}\
`,\
`@eq`(`'\1`'`,`'default_to_field`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#default_to_field.spec.xrep section=to_or_for_store class_name=$class_name\
 arg_field=$specification_\0_field arg_pfield=$specification_\0_pfield arg_sfield=$specification_\0_sfield\
 arg_tpfield=$specification_\0_tpfield arg_tfield=$specification_\0_tfield arg_tvalue=$specification_\0_tvalue\
 arg_append=$specification_\0_append arg_not_dflt=$specification_\0_not_dflt arg_cvt_func=$specification_\0_cvt_func\
 arg_fistexttype=$specification_\0_fistexttype arg_inc_clones=$specification_\0_inc_clones`}\
`,\
`@eq`(`'\1`'`,`'default_to_uid`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#default_to_uid.spec.xrep section=to_or_for_store class_name=$class_name\
 arg_field=$specification_\0_field arg_force_for_clone=$specification_\0_force_for_clone`}\
`,\
`@eq`(`'\1`'`,`'field_bool_dtm`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#field_bool_dtm.spec.xrep section=to_or_for_store class_name=$class_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield\
 arg_amount=$specification_\0_amount arg_type=$specification_\0_type arg_older=$specification_\0_older`}\
`,\
`@eq`(`'\1`'`,`'field_bool_from_other_enum`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#field_bool_from_other_enum.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield\
 arg_value=$specification_\0_value arg_evalue=$specification_\0_evalue\
 arg_sfistexttype=$specification_\0_sfistexttype`}\
`,\
`@eq`(`'\1`'`,`'field_bool_has_changed`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#field_bool_has_changed.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_value=$specification_\0_value\
 arg_sfield=$specification_\0_sfield arg_sfistexttype=$specification_\0_sfistexttype\
 arg_not_null=$specification_\0_not_null arg_var=$specification_\0_var`}\
`,\
`@eq`(`'\1`'`,`'field_bool_is_default`'`)`&`@eq`(`$specification_\0_for_store`,`'`'`)`&`@eq`(`$specification_\0_post_init`,`'`'`)
`{`#field_bool_is_default.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield arg_is_neq=$specification_\0_is_neq`}\
`,\
`@eq`(`'\1`'`,`'field_bool_matched_clone`'`)
`{`#field_bool_matched_clone.spec.xrep section=for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield arg_tfield=$specification_\0_tfield\
 arg_key_suffix=$specification_\0_key_suffix arg_not_equal=$specification_\0_not_equal arg_true_only=$specification_\0_true_only`}\
`,\
`@eq`(`'\1`'`,`'field_bool_uid`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)`&`@eq`(`$specification_\0_post_init`,`'`'`)
`{`#field_bool_uid.spec.xrep section=to_or_for_store class_name=$class_name\
 arg_field=$specification_\0_field arg_admin=$specification_\0_admin\
 arg_system=$specification_\0_system arg_not_equal=$specification_\0_not_equal`}\
`,\
`@eq`(`'\1`'`,`'field_clear`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#field_clear.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield arg_spfield=$specification_\0_spfield\
 arg_tfield=$specification_\0_tfield arg_fistexttype=$specification_\0_fistexttype arg_is_neg=$specification_\0_is_neg\
 arg_set_to_default=$specification_\0_set_to_default`}\
`,\
`@eq`(`'\1`'`,`'field_clear_on_changed_fk`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#field_clear_on_changed_fk.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_pfield=$specification_\0_pfield arg_field=$specification_\0_field\
 arg_tfield=$specification_\0_tfield arg_tpfield=$specification_\0_tpfield arg_tvalue=$specification_\0_tvalue\
 arg_not_dflt=$specification_\0_not_dflt arg_not_create=$specification_\0_not_create\
 arg_fistexttype=$specification_\0_fistexttype arg_set_to_default=$specification_\0_set_to_default`}\
`,\
`@eq`(`'\1`'`,`'field_from_acyclic_path`'`)`&`@eq`(`$specification_\0_ftransient`,`'0`'`)
`{`#field_from_acyclic_path.spec.xrep section=after_fetch_or_for_store full_class_name=$full_class_name\
 arg_pfield=$specification_\0_pfield arg_src_field=$specification_\0_src_field\
 arg_dest_field=$specification_\0_dest_field arg_separator=$specification_\0_separator\
 arg_embed_links=$specification_\0_embed_links arg_external=$specification_\0_external\
 arg_ftransient=specification_\0_ftransient arg_ext_field=$specification_\0_ext_field`}\
`,\
`@eq`(`'\1`'`,`'field_from_changed_fk`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#field_from_changed_fk.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_pfield=$specification_\0_pfield arg_dfield=$specification_\0_dfield\
 arg_sfield=$specification_\0_sfield arg_new_only=$specification_\0_new_only\
 arg_not_create=$specification_\0_not_create arg_inc_dflt=$specification_\0_inc_dflt\
 arg_not_null=$specification_\0_not_null arg_trigger_only=$specification_\0_trigger_only`}\
`,\
`@eq`(`'\1`'`,`'field_from_child_concat`'`)`&`?`$specification_\0_field`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#field_from_child_concat.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_cfield=$specification_\0_cfield arg_ofield=$specification_\0_ofield\
 arg_children=$specification_\0_children arg_cclass=$specification_\0_cclass arg_separator=$specification_\0_separator\
 arg_ctransient=$specification_\0_ctransient arg_embed_links=$specification_\0_embed_links\
 arg_tfield=$specification_\0_tfield arg_tvalue=$specification_\0_tvalue arg_tfistexttype=$specification_\0_tfistexttype\
 arg_xpfield=$specification_\0_xpfield arg_xdfield=$specification_\0_xdfield`}\
`,\
`@eq`(`'\1`'`,`'field_from_dtm`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#field_from_dtm.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field`}\
`,\
`@eq`(`'\1`'`,`'field_from_op`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#field_from_op.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield arg_spfield=$specification_\0_spfield\
 arg_tfield=$specification_\0_tfield arg_value=$specification_\0_value arg_ofield=$specification_\0_ofield\
 arg_sfistexttype=$specification_\0_sfistexttype arg_scfistexttype=$specification_\0_scfistexttype\
 arg_op=$specification_\0_op arg_type=$specification_\0_type arg_check=$specification_\0_check\
 arg_tfistexttype=$specification_\0_tfistexttype arg_update=$specification_\0_update`}\
`,\
`@eq`(`'\1`'`,`'field_from_other_field`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#field_from_other_field.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_sfield=$specification_\0_sfield arg_pfield=$specification_\0_pfield arg_dfield=$specification_\0_dfield\
 arg_tfield=$specification_\0_tfield arg_tpfield=$specification_\0_tpfield arg_tvalue=$specification_\0_tvalue\
 arg_chk_null=$specification_\0_chk_null arg_func=$specification_\0_func arg_create_only=$specification_\0_create_only\
 arg_mfunc=$specification_\0_mfunc arg_nvalue=$specification_\0_nvalue arg_update=$specification_\0_update\
 arg_tfistexttype=$specification_\0_tfistexttype arg_tcfistexttype=$specification_\0_tcfistexttype\
 arg_internal_only=$specification_\0_internal_only arg_include_clones=$specification_\0_include_clones`}\
`,\
`@eq`(`'\1`'`,`'field_from_uid`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#field_from_uid.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_tfield=$specification_\0_tfield arg_create_only=$specification_\0_create_only`}\
`,\
`@eq`(`'\1`'`,`'field_from_unary_op`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#field_from_unary_op.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield arg_tfield=$specification_\0_tfield\
 arg_op=$specification_\0_op arg_update=$specification_\0_update`}\
`,\
`@eq`(`'\1`'`,`'field_from_updating_graph_parent`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#field_from_updating_graph_parent.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_spclass=$specification_\0_spclass arg_scfield=$specification_\0_scfield\
 arg_tvalue=$specification_\0_tvalue`}\
`,\
`@eq`(`'\1`'`,`'field_swap_fk`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#field_swap_fk.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_fk_1=$specification_\0_fk_1 arg_fk_2=$specification_\0_fk_2 arg_ofield=$specification_\0_ofield\
 arg_o2field=$specification_\0_o2field arg_tfield=$specification_\0_tfield arg_update=$specification_\0_update\
 arg_create_only=$specification_\0_create_only`}\
`,\
`@eq`(`'\1`'`,`'field_to_value`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#field_to_value.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_fistexttype=$specification_\0_fistexttype\
 arg_tfield=$specification_\0_tfield arg_value=$specification_\0_value arg_evalue=$specification_\0_evalue\
 arg_update=$specification_\0_update arg_create_only=$specification_\0_create_only\
 arg_update_only=$specification_\0_update_only arg_internal_only=$specification_\0_internal_only`}\
`,\
`@eq`(`'\1`'`,`'field_to_value_for_updating_graph_parent`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#field_to_value_for_updating_graph_parent.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_spclass=$specification_\0_spclass arg_scfield=$specification_\0_scfield\
 arg_tfield=$specification_\0_tfield arg_value=$specification_\0_value arg_tvalue=$specification_\0_tvalue\
 arg_fistexttype=$specification_\0_fistexttype arg_tfistexttype=$specification_\0_tfistexttype`}\
`,\
`@eq`(`'\1`'`,`'field_value`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#field_value.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_tfield=$specification_\0_tfield arg_tpfield=$specification_\0_tpfield\
 arg_value=$specification_\0_value arg_not_null=$specification_\0_not_null arg_not_create=$specification_\0_not_create`}\
`,\
`@eq`(`'\1`'`,`'file_attachment`'`)`&`?`$specification_\0_sfield`&`!`@eq`(`$specification_\0_sfield`,`'`'`)
`{`#file_attachment.spec.xrep section=for_store arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield`}\
`,\
`@eq`(`'\1`'`,`'file_content`'`)
`{`#file_content.spec.xrep section=for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield`}\
`,\
`@eq`(`'\1`'`,`'file_link`'`)
`{`#file_link.spec.xrep section=for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_field1=$specification_\0_field1\
 arg_field2=$specification_\0_field2 arg_pfield2=$specification_\0_pfield2 arg_ext=$specification_\0_ext`}\
`,\
`@eq`(`'\1`'`,`'file_link_demo`'`)
`{`#file_link_demo.spec.xrep section=for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_exts=$specification_\0_exts`}\
`,\
`@eq`(`'\1`'`,`'fk_link_first_child`'`)`&`@eq`(`$specification_\0_for_store`,`'true`'`)
`{`#fk_link_first_child.spec.xrep section=to_or_for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_pfield=$specification_\0_pfield arg_fmandatory=$specification_\0_fmandatory\
 arg_child=$specification_\0_child arg_child_class=$specification_\0_child_class arg_child_field=$specification_\0_child_field\
 arg_order_field=$specification_\0_order_field arg_status_field=$specification_\0_status_field\
 arg_status_value=$specification_\0_status_value arg_new_only=$specification_\0_new_only\
 arg_reverse=$specification_\0_reverse arg_not_create=$specification_\0_not_create`}\
`,\
`@eq`(`'\1`'`,`'for_auto_code_user`'`)
`{`#for_auto_code_user.spec.xrep section=for_store class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field arg_auto_class=$specification_\0_auto_class\
 arg_inc_proc=$specification_\0_inc_proc arg_inc_clones=$specification_\0_inc_clones arg_key=$specification_\0_key`}\
`,\
`@eq`(`'\1`'`,`'meta_relationship_field`'`)
`{`#meta_relationship_field.spec.xrep section=for_store module_name=$module_name\
 arg_fclass=$specification_\0_fclass arg_mclass=$specification_\0_mclass arg_gclass=$specification_\0_gclass\
 arg_field_list=$specification_\0_field_list arg_tfield=$specification_\0_tfield\
 arg_xfield=$specification_\0_xfield arg_xsfield=$specification_\0_xsfield arg_ifield=$specification_\0_ifield\
 arg_idfield=$specification_\0_idfield arg_fidfield=$specification_\0_fidfield arg_keyfield=$specification_\0_keyfield`}\
`,\
`@eq`(`'\1`'`,`'parent_auto_int_inc`'`)
`{`#parent_auto_int_inc.spec.xrep section=for_store module_name=$module_name\
 arg_field=$specification_\0_field arg_pclass=$specification_\0_pclass arg_pfield=$specification_\0_pfield\
 arg_cfield=$specification_\0_cfield arg_static=$specification_\0_static arg_fmandatory=$specification_\0_fmandatory`}\
`,\
`@eq`(`'\1`'`,`'parent_field_from_other`'`)
`{`#parent_field_from_other.spec.xrep section=for_store module_name=$module_name\
 arg_pclass=$specification_\0_pclass arg_pfield=$specification_\0_pfield arg_dfield=$specification_\0_dfield\
 arg_sfield=$specification_\0_sfield arg_spfield=$specification_\0_spfield\
 arg_tfield=$specification_\0_tfield arg_test_value=$specification_\0_test_value`}\
`,\
`@eq`(`'\1`'`,`'prior_version`'`)
`{`#prior_version.spec.xrep section=for_store\
 class_name=$class_name full_class_name=$full_class_name module_name=$module_name\
 arg_pvchild=$specification_\0_pvchild\
 arg_ver_field=$specification_\0_ver_field\
 arg_field_list=$specification_\0_field_list\
 arg_major_only=$specification_\0_major_only\
 arg_test_field=$specification_\0_test_field\
 arg_test_value=$specification_\0_test_value`}\
`,\
`@eq`(`'\1`'`,`'total_child_field_in_parent`'`)`&`@eq`(`$specification_\0_after_self`,`'`'`)
`{`#total_child_field_in_parent.spec.xrep section=for_or_after_store class_name=$class_name module_name=$module_name\
 arg_nfield=$specification_\0_nfield arg_n2field=$specification_\0_n2field arg_n3field=$specification_\0_n3field\
 arg_pfield=$specification_\0_pfield arg_pnfield=$specification_\0_pnfield arg_pn2field=$specification_\0_pn2field\
 arg_pn3field=$specification_\0_pn3field arg_tfield=$specification_\0_tfield arg_sfield=$specification_\0_sfield`}\
`,\
`@eq`(`'\1`'`,`'update_children`'`)`&`@eq`(`$specification_\0_after_self`,`'`'`)
`{`#update_children.spec.xrep section=for_or_after_store full_class_name=$full_class_name\
 arg_child=$specification_\0_child arg_tfield=$specification_\0_tfield\
 arg_tvalue=$specification_\0_tvalue arg_not_var=$specification_\0_not_var`}\
`,\
`@eq`(`'\1`'`,`'update_parent`'`)`&`@eq`(`$specification_\0_after_store`,`'`'`)
`{`#update_parent.spec.xrep section=for_or_after_store class_name=$class_name module_name=$module_name\
 arg_tfield=$specification_\0_tfield arg_spfield=$specification_\0_spfield arg_scfield=$specification_\0_scfield`}\
### for_store
`}`]`}

   // [<start for_store>]
`{`(`?`$user_source`)`#$user_source section=for_store`}
   // [<finish for_store>]
`{`(`?`$auto_round_fields`)
`}`{`?`$auto_round_fields`[`$auto_round_fields`%,`,\
   v_\0.round( \1, \2 );\
`+\n`]`}
}

void `{`$full_class_name`}::impl::after_store( bool is_create, bool is_internal )
{
   ( void )is_create;
   ( void )is_internal;
`{`?`$all_after_store_specifications`[`$all_after_store_specifications`%,`,\
`{`@eq`(`'\1`'`,`'child_field_cascade`'`)`&`@eq`(`$specification_\0_after_self`,`'true`'`)
`{`#child_field_cascade.spec.xrep section=for_or_after_store class_name=$class_name module_name=$module_name\
 arg_child=$specification_\0_child arg_field_list=$specification_\0_field_list arg_testop=$specification_\0_testop\
 arg_tfield=$specification_\0_tfield arg_ctfield=$specification_\0_ctfield arg_check_orig=$specification_\0_check_orig\
 arg_any_change=$specification_\0_any_change`}\
`,\
`@eq`(`'\1`'`,`'clone_children`'`)
`{`#clone_children.spec.xrep section=after_store full_class_name=$full_class_name\
 arg_child=$specification_\0_child arg_pfield=$specification_\0_pfield\
 arg_tfield=$specification_\0_tfield arg_tvalue=$specification_\0_tvalue\
 arg_not_eq=$specification_\0_not_eq arg_copy_files=$specification_\0_copy_files`}\
`,\
`@eq`(`'\1`'`,`'clone_children_for_create`'`)
`{`#clone_children_for_create.spec.xrep section=after_store full_class_name=$full_class_name\
 arg_class=$specification_\0_class arg_pfield=$specification_\0_pfield arg_sfield=$specification_\0_sfield\
 arg_child=$specification_\0_child arg_gclass=$specification_\0_gclass arg_gchild=$specification_\0_gchild\
 arg_gpfield=$specification_\0_gpfield arg_vsfield=$specification_\0_vsfield arg_vdfield=$specification_\0_vdfield\
 arg_combine_keys=$specification_\0_combine_keys`}\
`,\
`@eq`(`'\1`'`,`'clone_children_for_update`'`)
`{`#clone_children_for_update.spec.xrep section=after_store full_class_name=$full_class_name\
 arg_pfield=$specification_\0_pfield arg_sfield=$specification_\0_sfield\
 arg_child=$specification_\0_child arg_xfield=$specification_\0_xfield`}\
`,\
`@eq`(`'\1`'`,`'clone_children_from_fk`'`)
`{`#clone_children_from_fk.spec.xrep section=after_store full_class_name=$full_class_name\
 arg_child=$specification_\0_child arg_pfield=$specification_\0_pfield\
 arg_fkfield=$specification_\0_fkfield arg_fkchild=$specification_\0_fkchild arg_cpfield=$specification_\0_cpfield`}\
`,\
`@eq`(`'\1`'`,`'clone_default_for_group`'`)
`{`#clone_default_for_group.spec.xrep section=after_store full_class_name=$full_class_name\
 arg_cclass=$specification_\0_cclass arg_gfield=$specification_\0_gfield`}\
`,\
`@eq`(`'\1`'`,`'clone_default_group_children`'`)
`{`#clone_default_group_children.spec.xrep section=after_store module_name=$module_name full_class_name=$full_class_name\
 arg_cclass=$specification_\0_cclass arg_child=$specification_\0_child arg_gfield=$specification_\0_gfield`}\
`,\
`@eq`(`'\1`'`,`'copy_child_links_from_fk`'`)
`{`#copy_child_links_from_fk.spec.xrep section=after_store class_name=$class_name\
 arg_cclass=$specification_\0_cclass arg_fkclass=$specification_\0_fkclass arg_fkfield=$specification_\0_fkfield\
 arg_fkcclass=$specification_\0_fkcclass arg_fkcfield=$specification_\0_fkcfield\
 arg_field_list=$specification_\0_field_list arg_combine_keys=$specification_\0_combine_keys\
 arg_cfield=$specification_\0_cfield arg_cpfield=$specification_\0_cpfield\
 arg_fk_from_child=$specification_\0_fk_from_child`}\
`,\
`@eq`(`'\1`'`,`'create_child`'`)
`{`#create_child.spec.xrep section=after_store full_class_name=$full_class_name\
 arg_child=$specification_\0_child arg_pfield=$specification_\0_pfield\
 arg_field=$specification_\0_field arg_value=$specification_\0_value\
 arg_nfield=$specification_\0_nfield arg_field_list=$specification_\0_field_list\
 arg_clone_field=$specification_\0_clone_field arg_create_only=$specification_\0_create_only\
 arg_key_suffix=$specification_\0_key_suffix`}\
`,\
`@eq`(`'\1`'`,`'create_children_for_fk_children`'`)
`{`#create_children_for_fk_children.spec.xrep section=after_store full_class_name=$full_class_name\
 arg_fkfield=$specification_\0_fkfield arg_fkcfield=$specification_\0_fkcfield\
 arg_cname=$specification_\0_cname arg_cfield=$specification_\0_cfield\
 arg_field_list=$specification_\0_field_list`}\
`,\
`@eq`(`'\1`'`,`'field_from_child_concat`'`)`&`!`?`$specification_\0_class\
`&`?`$specification_\0_cclass`&`@eq`(`$class_name`,`$specification_\0_cclass`)
`{`#field_from_child_concat.spec.xrep section=after_store class_name=$class_name module_name=$module_name\
 arg_cfield=$specification_\0_cfield arg_ofield=$specification_\0_ofield\
 arg_pfield=$specification_\0_pfield arg_tfield=$specification_\0_tfield`}\
`,\
`@eq`(`'\1`'`,`'total_child_field_in_parent`'`)`&`@eq`(`$specification_\0_after_self`,`'true`'`)
`{`#total_child_field_in_parent.spec.xrep section=for_or_after_store class_name=$class_name module_name=$module_name\
 arg_nfield=$specification_\0_nfield arg_n2field=$specification_\0_n2field arg_n3field=$specification_\0_n3field\
 arg_pfield=$specification_\0_pfield arg_pnfield=$specification_\0_pnfield arg_pn2field=$specification_\0_pn2field\
 arg_pn3field=$specification_\0_pn3field arg_tfield=$specification_\0_tfield arg_sfield=$specification_\0_sfield`}\
`,\
`@eq`(`'\1`'`,`'trigger_clone_default_user_children`'`)
`{`#trigger_clone_default_user_children.spec.xrep section=after_store module_name=$module_name class_name=$class_name\
 arg_child=$specification_\0_child arg_ufield=$specification_\0_ufield arg_skip_clones=$specification_\0_skip_clones\
 arg_tfield=$specification_\0_tfield arg_tvalue=$specification_\0_tvalue`}\
`,\
`@eq`(`'\1`'`,`'trigger_clone_for_fk_children`'`)
`{`#trigger_clone_for_fk_children.spec.xrep section=after_store module_name=$module_name class_name=$class_name\
 arg_sparent=$specification_\0_sparent arg_tfield=$specification_\0_tfield\
 arg_children=$specification_\0_children arg_schildren=$specification_\0_schildren`}\
`,\
`@eq`(`'\1`'`,`'trigger_copy_fk_children_below_other_fk`'`)
`{`#trigger_copy_fk_children_below_other_fk.spec.xrep section=after_store module_name=$module_name class_name=$class_name\
 arg_tfield=$specification_\0_tfield arg_src_fk=$specification_\0_src_fk arg_schild=$specification_\0_schild\
 arg_src_tfield=$specification_\0_src_tfield arg_src_fk_key_class=$specification_\0_src_fk_key_class\
 arg_src_fk_key_suffix=$specification_\0_src_fk_key_suffix arg_dest_fk=$specification_\0_dest_fk\
 arg_dchild=$specification_\0_dchild arg_fk_back_to_self=$specification_\0_fk_back_to_self\
 arg_fk_src_child_branch=$specification_\0_fk_src_child_branch arg_create_or_update=$specification_\0_create_or_update`}\
`,\
`@eq`(`'\1`'`,`'update_children`'`)`&`@eq`(`$specification_\0_after_self`,`'true`'`)
`{`#update_children.spec.xrep section=for_or_after_store full_class_name=$full_class_name\
 arg_child=$specification_\0_child arg_tfield=$specification_\0_tfield\
 arg_tvalue=$specification_\0_tvalue arg_not_var=$specification_\0_not_var`}\
`,\
`@eq`(`'\1`'`,`'update_parent`'`)`&`@eq`(`$specification_\0_after_store`,`'true`'`)
`{`#update_parent.spec.xrep section=for_or_after_store class_name=$class_name module_name=$module_name\
 arg_tfield=$specification_\0_tfield arg_spfield=$specification_\0_spfield arg_scfield=$specification_\0_scfield`}\
`,\
`@eq`(`'\1`'`,`'update_parent_cascade`'`)
`{`#update_parent_cascade.spec.xrep section=after_store module_name=$module_name full_class_name=$full_class_name\
 arg_pclass=$specification_\0_pclass arg_pfield=$specification_\0_pfield arg_fkfield=$specification_\0_fkfield\
 arg_tvalue=$specification_\0_tvalue arg_grand_parent=$specification_\0_grand_parent`}\
### after_store
`}`]`}

   // [<start after_store>]
`{`(`?`$user_source`)`#$user_source section=after_store`}
   // [<finish after_store>]
}

bool `{`$full_class_name`}::impl::can_destroy( bool is_internal )
{
   bool retval = is_internal || !( get_state( ) & c_state_undeletable );
`{`?`$all_can_destroy_specifications`[`$all_can_destroy_specifications`%,`,`{`@eq`(`'\1`'`,`'destroy_restrict`'`)
`{`#destroy_restrict.spec.xrep section=can_destroy\
 arg_field=$specification_\0_field arg_pfield=$specification_\0_pfield\
 arg_value=$specification_\0_value arg_allow_internal=$specification_\0_allow_internal`}`}\
`]`}

   // [<start can_destroy>]
`{`(`?`$user_source`)`#$user_source section=can_destroy`}
   // [<finish can_destroy>]

   return retval;
}

void `{`$full_class_name`}::impl::for_destroy( bool is_internal )
{
   ( void )is_internal;
`{`?`$all_for_destroy_specifications`[`$all_for_destroy_specifications`%,`,\
`{`@eq`(`'\1`'`,`'file_attachment`'`)
`{`#file_attachment.spec.xrep section=for_destroy arg_field=$specification_\0_field`}\
`,\
`@eq`(`'\1`'`,`'file_link`'`)
`{`#file_link.spec.xrep section=for_destroy class_name=$class_name module_name=$module_name\
 arg_field=$specification_\0_field`}\
`,\
`@eq`(`'\1`'`,`'meta_relationship_field`'`)
`{`#meta_relationship_field.spec.xrep section=for_destroy module_name=$module_name arg_fclass=$specification_\0_fclass`}\
`,\
`@eq`(`'\1`'`,`'total_child_field_in_parent`'`)`&`@eq`(`$specification_\0_after_self`,`'`'`)
`{`#total_child_field_in_parent.spec.xrep section=for_or_after_destroy class_name=$class_name module_name=$module_name\
 arg_nfield=$specification_\0_nfield arg_n2field=$specification_\0_n2field arg_n3field=$specification_\0_n3field\
 arg_pfield=$specification_\0_pfield arg_pnfield=$specification_\0_pnfield arg_pn2field=$specification_\0_pn2field\
 arg_pn3field=$specification_\0_pn3field arg_tfield=$specification_\0_tfield arg_sfield=$specification_\0_sfield`}\
### for_destroy
`}`]`}

   // [<start for_destroy>]
`{`(`?`$user_source`)`#$user_source section=for_destroy`}
   // [<finish for_destroy>]
}

void `{`$full_class_name`}::impl::after_destroy( bool is_internal )
{
   ( void )is_internal;
`{`?`$all_after_destroy_specifications`[`$all_after_destroy_specifications`%,`,\
`{`@eq`(`'\1`'`,`'field_from_child_concat`'`)`&`!`?`$specification_\0_class\
`&`?`$specification_\0_cclass`&`@eq`(`$class_name`,`$specification_\0_cclass`)
`{`#field_from_child_concat.spec.xrep section=after_destroy class_name=$class_name module_name=$module_name\
 arg_pfield=$specification_\0_pfield arg_tfield=$specification_\0_tfield arg_tvalue=$specification_\0_tvalue\
 arg_tfistexttype=$specification_\0_tfistexttype`}\
`,\
`@eq`(`'\1`'`,`'total_child_field_in_parent`'`)`&`@eq`(`$specification_\0_after_self`,`'true`'`)
`{`#total_child_field_in_parent.spec.xrep section=for_or_after_destroy class_name=$class_name module_name=$module_name\
 arg_nfield=$specification_\0_nfield arg_n2field=$specification_\0_n2field arg_n3field=$specification_\0_n3field\
 arg_pfield=$specification_\0_pfield arg_pnfield=$specification_\0_pnfield arg_pn2field=$specification_\0_pn2field\
 arg_pn3field=$specification_\0_pn3field arg_tfield=$specification_\0_tfield arg_sfield=$specification_\0_sfield`}\
`,\
`@eq`(`'\1`'`,`'update_parent_cascade`'`)
`{`#update_parent_cascade.spec.xrep section=after_destroy module_name=$module_name full_class_name=$full_class_name\
 arg_pclass=$specification_\0_pclass arg_pfield=$specification_\0_pfield arg_fkfield=$specification_\0_fkfield\
 arg_tvalue=$specification_\0_tvalue arg_grand_parent=$specification_\0_grand_parent`}\
### after_destroy
`}`]`}

   // [<start after_destroy>]
`{`(`?`$user_source`)`#$user_source section=after_destroy`}
   // [<finish after_destroy>]
}

void `{`$full_class_name`}::impl::set_default_values( )
{
   clear( );
}

bool `{`$full_class_name`}::impl::is_filtered( ) const
{
`{`?`$all_is_filtered_specifications`[`$all_is_filtered_specifications`%,`,\
`{`@eq`(`'\1`'`,`'filter_field_value`'`)\
`{`#filter_field_value.spec.xrep section=is_filtered arg_name=\0\
 arg_id=$specification_\0_id arg_field=$specification_\0_field\
 arg_value=$specification_\0_value arg_tfield=$specification_\0_tfield arg_perm=$specification_\0_perm`}
`,\
`@eq`(`'\1`'`,`'filter_fk_in_uid_set`'`)\
`{`#filter_fk_in_uid_set.spec.xrep section=is_filtered arg_name=\0\
 arg_id=$specification_\0_id arg_tfield=$specification_\0_tfield arg_spfield=$specification_\0_spfield\
 arg_scfield=$specification_\0_scfield arg_vname=$specification_\0_vname`}
`,\
`@eq`(`'\1`'`,`'filter_perm_restricted`'`)\
`{`#filter_perm_restricted.spec.xrep section=is_filtered arg_name=\0\
 arg_id=$specification_\0_id arg_field=$specification_\0_field`}
`,\
`@eq`(`'\1`'`,`'filter_security_level`'`)\
`{`#filter_security_level.spec.xrep section=is_filtered arg_name=\0\
 arg_id=$specification_\0_id arg_slevel=$specification_\0_slevel`}
`,\
`@eq`(`'\1`'`,`'non_uid_filter`'`)\
`{`#non_uid_filter.spec.xrep section=is_filtered class_name=$class_name module_name=$module_name\
 arg_name=\0 arg_id=$specification_\0_id arg_pclass=$specification_\0_pclass arg_cfield=$specification_\0_cfield`}
### is_filtered
`}`]`}
   // [<start is_filtered>]
`{`(`?`$user_source`)`#$user_source section=is_filtered`}
   // [<finish is_filtered>]

   return false;
}

void `{`$full_class_name`}::impl::get_required_transients( ) const
{
   required_transients.clear( );

   get_obj( ).add_required_transients( required_transients );

   set< string > dependents( required_transients.begin( ), required_transients.end( ) );

   p_obj->get_required_field_names( required_transients, true, &dependents );

   // NOTE: It is possible that due to "interdependent" required fields
   // some required fields may not have been added in the first or even
   // later calls to "get_required_field_names" so continue calling the
   // function until no further field names have been added.
   size_t num_required = required_transients.size( );
   while( num_required )
   {
      p_obj->get_required_field_names( required_transients, true, &dependents );
      if( required_transients.size( ) == num_required )
         break;

      num_required = required_transients.size( );
   }
}

`{`(`?`$use_transform`)
void `{`$full_class_name`}::impl::transform( read_stream& rs, int32_t version )
{
   if( version <= 0 || version > c_version )
      throw runtime_error( "unexpected version number #" + to_string( version ) );

   // [<start transform>]
`{`(`?`$user_source`)`#$user_source section=transform`}
   // [<finish transform>]

   p_obj->set_version( c_version );
}
`}
#undef MODULE_TRACE
#define MODULE_TRACE( x ) trace( x )

`{`$full_class_name`}::`{`$full_class_name`}( )
{
   set_version( c_version );

   p_impl = new impl( *this );
}

`{`$full_class_name`}::~`{`$full_class_name`}( )
{
`{`(`!`?`$parent_class`)\
   cleanup( );\
`}
   delete p_impl;
}
`{`?`$all_fields`[`$all_fields`%,`,\
`{`?`$basic_fields`&`@in`(`'\0`'`,`$basic_fields`)
\1 `{`$full_class_name`}::\0( ) const
{
   return p_impl->impl_\0( );
}

void `{`$full_class_name`}::\0( \1 \0 )
{
   p_impl->impl_\0( \0 );
}
`}\
`{`?`$complex_fields`&`@in`(`'\0`'`,`$complex_fields`)
const \1& `{`$full_class_name`}::\0( ) const
{
   return p_impl->impl_\0( );
}

void `{`$full_class_name`}::\0( const \1& \0 )
{
   p_impl->impl_\0( \0 );
}
`}\
`]`}`{`?`$all_fields`[`$all_fields`%,`,\
`{`@in`(`'\0`'`,`$parent_fields`)\

\1& `{`$full_class_name`}::\0( )
{
   return p_impl->impl_\0( );
}

const \1& `{`$full_class_name`}::\0( ) const
{
   return p_impl->impl_\0( );
}

void `{`$full_class_name`}::\0( const string& key )
{
   p_impl->impl_\0( key );
}
`}`]`}
`{`?`$child_info`[`$child_info`,\
\1& `{`$full_class_name`}::\0( )
{
   return p_impl->impl_\0( );
}

const \1& `{`$full_class_name`}::\0( ) const
{
   return p_impl->impl_\0( );
}`+\n\n`]
`}
`{`?`$all_procedures`[`$all_procedures`,\
void `{`$full_class_name`}::\$( \
`{`?`$\$_all_args`&`!`@eq`(`$\$_all_args`,`'`'`)`[`$\$_all_args`%,`,\
`{`@in`(`'\\0`'`,`$\$_all_simple_inputs`)\\1 \\0`}\
`{`@in`(`'\\0`'`,`$\$_all_complex_inputs`)const \\1& \\0`}\
`{`@in`(`'\\0`'`,`$\$_all_non_inputs`)\\1& \\0`}\
`+, `] `})
{
   p_impl->impl_\$( `{`?`$\$_all_args`&`!`@eq`(`$\$_all_args`,`'`'`)`[`$\$_all_args`%,`,\\0`+, `] `});
}`+\n\n`]
`}
string `{`$full_class_name`}::get_field_value( int field ) const
{
`{`!`(`?`$parent_class`)\
   return p_impl->get_field_value( field );\
`,\
   int num_parent_fields( parent_class_type::get_num_fields( ) );

   if( field < num_parent_fields )
      return parent_class_type::get_field_value( field );
   else
      return p_impl->get_field_value( field - num_parent_fields );\
`}
}

void `{`$full_class_name`}::set_field_value( int field, const string& value )
{
`{`!`(`?`$parent_class`)\
   p_impl->set_field_value( field, value );\
`,\
   int num_parent_fields( parent_class_type::get_num_fields( ) );

   if( field < num_parent_fields )
      parent_class_type::set_field_value( field, value );
   else
      p_impl->set_field_value( field - num_parent_fields, value );\
`}
}

bool `{`$full_class_name`}::is_field_transient( int field ) const
{
`{`!`(`?`$parent_class`)\
   return static_is_field_transient( ( field_id )( field + 1 ) );\
`,\
   int num_parent_fields( parent_class_type::get_num_fields( ) );

   if( field < num_parent_fields )
      return parent_class_type::is_field_transient( field );
   else
      return static_is_field_transient( ( field_id )( field - num_parent_fields + 1 ) );\
`}
}

string `{`$full_class_name`}::get_field_name( int field ) const
{
`{`!`(`?`$parent_class`)\
   return static_get_field_name( ( field_id )( field + 1 ) );\
`,\
   int num_parent_fields( parent_class_type::get_num_fields( ) );

   if( field < num_parent_fields )
      return parent_class_type::get_field_name( field );
   else
      return static_get_field_name( ( field_id )( field - num_parent_fields + 1 ) );\
`}
}

int `{`$full_class_name`}::get_field_num( const string& field ) const
{
   int rc = static_get_field_num( field );

   if( rc < 0 )
      throw runtime_error( "unknown field name/id '" + field + "' in get_field_num( )" );

   return rc;
}

bool `{`$full_class_name`}::has_field_changed( const string& field ) const
{
   return class_base::has_field_changed( get_field_num( field ) );
}

uint64_t `{`$full_class_name`}::get_state( ) const
{
   uint64_t state = 0;

`{`(`?`$parent_class`)\
   state |= parent_class_type::get_state( );\
`}
   state |= p_impl->get_state( );

   return state;
}

const string& `{`$full_class_name`}::execute( const string& cmd_and_args )
{
   return p_impl->execute( cmd_and_args );
}

void `{`$full_class_name`}::clear( )
{
`{`(`?`$parent_class`)\
   parent_class_type::clear( );\
`}
   p_impl->clear( );
}

void `{`$full_class_name`}::validate( unsigned state, bool is_internal )
{
`{`(`?`$parent_class`)\
   parent_class_type::validate( state, is_internal );\
`}
   p_impl->validate( state, is_internal, &validation_errors );
}

void `{`$full_class_name`}::validate_set_fields( set< string >& fields_set )
{
`{`(`?`$parent_class`)\
   parent_class_type::validate_set_fields( fields_set );\
`}
   p_impl->validate_set_fields( fields_set, &validation_errors );
}

void `{`$full_class_name`}::after_fetch( )
{
`{`(`?`$parent_class`)\
   parent_class_type::after_fetch( );\
`}
   p_impl->after_fetch( );
}

void `{`$full_class_name`}::finalise_fetch( )
{
`{`(`?`$parent_class`)\
   parent_class_type::finalise_fetch( );\
`}
   p_impl->finalise_fetch( );
}

void `{`$full_class_name`}::at_create( )
{
`{`(`?`$parent_class`)\
   parent_class_type::at_create( );\
`}
   p_impl->at_create( );
}

void `{`$full_class_name`}::post_init( )
{
`{`(`?`$parent_class`)\
   parent_class_type::post_init( );\
`}
   p_impl->post_init( );
}

void `{`$full_class_name`}::to_store( bool is_create, bool is_internal )
{
`{`(`?`$parent_class`)\
   parent_class_type::to_store( is_create, is_internal );\
`}
   p_impl->to_store( is_create, is_internal );
}

void `{`$full_class_name`}::for_store( bool is_create, bool is_internal )
{
`{`(`?`$parent_class`)\
   parent_class_type::for_store( is_create, is_internal );\
`}
   p_impl->for_store( is_create, is_internal );
}

void `{`$full_class_name`}::after_store( bool is_create, bool is_internal )
{
`{`(`?`$parent_class`)\
   parent_class_type::after_store( is_create, is_internal );\
`}
   p_impl->after_store( is_create, is_internal );
}

bool `{`$full_class_name`}::can_destroy( bool is_internal )
{
`{`(`?`$parent_class`)\
   if( !parent_class_type::can_destroy( is_internal ) )
      return false;\
`}
   return p_impl->can_destroy( is_internal );
}

void `{`$full_class_name`}::for_destroy( bool is_internal )
{
   p_impl->for_destroy( is_internal );
`{`(`?`$parent_class`)\
   parent_class_type::for_destroy( is_internal );\
`}
}

void `{`$full_class_name`}::after_destroy( bool is_internal )
{
   p_impl->after_destroy( is_internal );
`{`(`?`$parent_class`)\
   parent_class_type::after_destroy( is_internal );\
`}
}

void `{`$full_class_name`}::set_default_values( )
{
`{`(`?`$parent_class`)\
   parent_class_type::set_default_values( );\
`}
   p_impl->set_default_values( );
}

bool `{`$full_class_name`}::is_filtered( ) const
{
`{`(`?`$parent_class`)\
   if( parent_class_type::is_filtered( ) )
      return true;
`}
   return p_impl->is_filtered( );
}

const char* `{`$full_class_name`}::get_field_id(
 const string& name, bool* p_sql_numeric, string* p_type_name ) const
{
`{`(`?`$parent_class`)\
   const char* p_id( parent_class_type::get_field_id( name, p_sql_numeric, p_type_name ) );
   if( p_id )
      return p_id;\
`,\
   const char* p_id( 0 );\
`}

   if( name.empty( ) )
      throw runtime_error( "unexpected empty field name for get_field_id" );
`{`?`$all_fields`[`$all_fields`%,`,\
   else if( name == c_field_name_\0 )
   {
      p_id = c_field_id_\0;

      if( p_type_name )
         *p_type_name = "\1";

      if( p_sql_numeric )
         *p_sql_numeric = `{`?`$sql_numeric_fields`&`@in`(`'\0`'`,`$sql_numeric_fields`)true`,false`};
   }\
`+\n`]`}

   return p_id;
}

const char* `{`$full_class_name`}::get_field_name(
 const string& id, bool* p_sql_numeric, string* p_type_name ) const
{
`{`(`?`$parent_class`)\
   const char* p_name( parent_class_type::get_field_name( id, p_sql_numeric, p_type_name ) );

   if( p_name )
      return p_name;\
`,\
   const char* p_name( 0 );\
`}

   if( id.empty( ) )
      throw runtime_error( "unexpected empty field id for get_field_name" );
`{`?`$all_fields`[`$all_fields`%,`,\
   else if( id == c_field_id_\0 )
   {
      p_name = c_field_name_\0;

      if( p_type_name )
         *p_type_name = "\1";

      if( p_sql_numeric )
         *p_sql_numeric = `{`?`$sql_numeric_fields`&`@in`(`'\0`'`,`$sql_numeric_fields`)true`,false`};
   }\
`+\n`]`}

   return p_name;
}

string& `{`$full_class_name`}::get_order_field_name( ) const
{
`{`(`?`$parent_class`)\
   return parent_class_type::get_order_field_name( );\
`,\
   return g_order_field_name;\
`}
}

bool `{`$full_class_name`}::is_file_field_name( const string& name ) const
{
`{`(`?`$parent_class`)\
   return parent_class_type::is_file_field_name( name ) || g_file_field_names.count( name );\
`,\
   return g_file_field_names.count( name );\
`}
}

void `{`$full_class_name`}::get_file_field_names( vector< string >& file_field_names ) const
{
`{`(`?`$parent_class`)\
   parent_class_type::get_file_field_names( file_field_names );
`}
   for( set< string >::const_iterator ci = g_file_field_names.begin( ); ci != g_file_field_names.end( ); ++ci )
      file_field_names.push_back( *ci );
}

string `{`$full_class_name`}::get_field_uom_symbol( const string& id_or_name ) const
{
`{`(`?`$parent_class`)\
   string uom_symbol( parent_class_type::get_field_uom_symbol( id_or_name ) );
   if( !uom_symbol.empty( ) )
      return uom_symbol;\
`,\
   string uom_symbol;\
`}

   string name;
   pair< string, string > next;

   if( id_or_name.empty( ) )
      throw runtime_error( "unexpected empty field id_or_name for get_field_uom_symbol" );
`{`?`$all_fields`[`$all_fields`%,`,\
   else if( id_or_name == c_field_id_\0 || id_or_name == c_field_name_\0 )
   {
      name = string( c_field_display_name_\0 );
      get_module_string( c_field_display_name_\0, &next );
   }\
`+\n`]`}

   // NOTE: It is being assumed here that the customised UOM symbol for a field (if it
   // has one) will be in the module string that immediately follows that of its name.
   if( next.first.find( name + "_(" ) == 0 )
      uom_symbol = next.second;

   return uom_symbol;
}

string `{`$full_class_name`}::get_field_display_name( const string& id_or_name ) const
{
`{`(`?`$parent_class`)\
   string display_name( parent_class_type::get_field_display_name( id_or_name ) );
   if( !display_name.empty( ) )
      return display_name;\
`,\
   string display_name;\
`}

   if( id_or_name.empty( ) )
      throw runtime_error( "unexpected empty field id_or_name for get_field_display_name" );
`{`?`$all_fields`[`$all_fields`%,`,\
   else if( id_or_name == c_field_id_\0 || id_or_name == c_field_name_\0 )
      display_name = get_module_string( c_field_display_name_\0 );\
`+\n`]`}

   return display_name;
}

void `{`$full_class_name`}::clear_foreign_key( const string& field )
{
`{`(`?`$parent_class`)\
   if( has_field( field ) )
      p_impl->clear_foreign_key( field );
   else
      parent_class_type::clear_foreign_key( field );\
`,\
   p_impl->clear_foreign_key( field );\
`}
}

void `{`$full_class_name`}::set_foreign_key_value( const string& field, const string& value )
{
`{`(`?`$parent_class`)\
   if( has_field( field ) )
      p_impl->set_foreign_key_value( field, value );
   else
      parent_class_type::set_foreign_key_value( field, value );\
`,\
   p_impl->set_foreign_key_value( field, value );\
`}
}

const string& `{`$full_class_name`}::get_foreign_key_value( const string& field )
{
`{`(`?`$parent_class`)\
   if( has_field( field ) )
      return p_impl->get_foreign_key_value( field );
   else
      return parent_class_type::get_foreign_key_value( field );\
`,\
   return p_impl->get_foreign_key_value( field );\
`}
}

void `{`$full_class_name`}::get_foreign_key_values( foreign_key_data_container& foreign_key_values ) const
{
`{`(`?`$parent_class`)\
   parent_class_type::get_foreign_key_values( foreign_key_values );\
`}
   p_impl->get_foreign_key_values( foreign_key_values );
}
`{`?`$parent_types`[`$parent_types`,
void `{`$full_class_name`}::setup_foreign_key( \$& o, const string& value )
{
   static_cast< \$& >( o ).set_key( value );
}`+\n`]`}
`{`?`$child_types`[`$child_types`,
void `{`$full_class_name`}::setup_graph_parent( \$& o, const string& foreign_key_field )
{
   static_cast< \$& >( o ).set_graph_parent( this, foreign_key_field );
}`+\n`]`}
`{`?`$parent_types`[`$parent_types`,
void `{`$full_class_name`}::setup_graph_parent(
 \$& o, const string& foreign_key_field, const string& init_value )
{
   static_cast< \$& >( o ).set_graph_parent( this, foreign_key_field, true );
   static_cast< \$& >( o ).set_key( init_value );
}`+\n`]`}

size_t `{`$full_class_name`}::get_total_child_relationships( ) const
{
   return p_impl->total_child_relationships;
}

void `{`$full_class_name`}::set_total_child_relationships( size_t new_total_child_relationships ) const
{
   p_impl->total_child_relationships = new_total_child_relationships;
}

size_t `{`$full_class_name`}::get_num_foreign_key_children( bool is_internal ) const
{
`{`(`?`$parent_class`)\
   size_t rc;
   if( is_internal )
      rc = `{`(`?`$child_info`)`{`@count`(`$child_info`)`}`,0`};
   else
      rc = `{`$parent_class`}::get_num_foreign_key_children( )`{`!`@eq`(`$is_alias`,`'true`'`)`&`(`?`$child_info`) + `{`@count`(`$child_info`)`}`};
`,\
   size_t rc = `{`!`(`?`$child_info`)0`,`{`@count`(`$child_info`)`}`};
`}
   if( !is_internal )
   {
      g_external_aliases_lookup.clear( );

      for( external_aliases_const_iterator
       eaci = g_external_aliases.begin( ), end = g_external_aliases.end( ); eaci != end; ++eaci )
      {
         size_t num_extra = eaci->second->get_num_foreign_key_children( true );

         if( num_extra )
         {
            eaci->second->set_key( get_key( ) );
            eaci->second->copy_all_field_values( *this );

            g_external_aliases_lookup.insert( make_pair( rc, eaci->second ) );

            rc += num_extra;
         }
      }
   }

   set_total_child_relationships( rc );

   return rc;
}

class_base* `{`$full_class_name`}::get_next_foreign_key_child(
 size_t child_num, string& next_child_field, cascade_op op, bool is_internal )
{
   class_base* p_class_base = 0;

`{`!`(`?`$child_info`)\
`{`(`?`$parent_class`)\
   p_class_base = `{`$parent_class`}::get_next_foreign_key_child( child_num, next_child_field, op );\
`,\
   ( void )child_num;
   ( void )next_child_field;
   ( void )op;\
`}`,\
`{`(`?`$parent_class`)\
   size_t num_parent_children = is_internal ? 0 : `{`$parent_class`}::get_total_child_relationships( );

   if( child_num < num_parent_children )
      p_class_base = `{`$parent_class`}::get_next_foreign_key_child( child_num, next_child_field, op );
   else
   {
      if( child_num >= num_parent_children + `{`@count`(`$child_info`)`} )
      {
         external_aliases_lookup_const_iterator ealci = g_external_aliases_lookup.lower_bound( child_num );
         if( ealci == g_external_aliases_lookup.end( ) || ealci->first > child_num )
            --ealci;

         p_class_base = ealci->second->get_next_foreign_key_child( child_num - ealci->first, next_child_field, op, true );
      }
      else
      {
         switch( child_num - num_parent_children )
         {
`{`[`$child_info`%,`,\
            case \\\\#:
            if( op == e_cascade_op_\\\\4 )
            {
               next_child_field = "\\\\3";
               p_class_base = &\\\\0( );
            }
            break;\
`+\n\n`]`}
         }
      }
   }\
`,\
   if( child_num >= `{`@count`(`$child_info`)`} )
   {
      external_aliases_lookup_const_iterator ealci = g_external_aliases_lookup.lower_bound( child_num );
      if( ealci == g_external_aliases_lookup.end( ) || ealci->first > child_num )
         --ealci;

      p_class_base = ealci->second->get_next_foreign_key_child( child_num - ealci->first, next_child_field, op, true );
   }
   else
   {
      switch( child_num )
      {
`{`[`$child_info`%,`,\
         case \\\\#:
         if( op == e_cascade_op_\\\\4 )
         {
            next_child_field = "\\\\3";
            p_class_base = &\\\\0( );
         }
         break;\
`+\n\n`]`}
      }
   }\
`}`}

   return p_class_base;
}

void `{`$full_class_name`}::add_extra_fixed_info( vector< pair< string, string > >& fixed_info ) const
{
`{`(`?`$parent_class`)\
   parent_class_type::add_extra_fixed_info( fixed_info );\
`}
   p_impl->add_extra_fixed_info( fixed_info );
}

void `{`$full_class_name`}::add_extra_paging_info( vector< pair< string, string > >& paging_info ) const
{
`{`(`?`$parent_class`)\
   parent_class_type::add_extra_paging_info( paging_info );\
`}
   p_impl->add_extra_paging_info( paging_info );
}

string `{`$full_class_name`}::get_class_id( ) const
{
`{`@eq`(`$is_alias`,`'true`'`)\
   return parent_class_type::get_class_id( );\
`,\
   return static_class_id( );\
`}
}

string `{`$full_class_name`}::get_class_name( ) const
{
   return static_class_name( );
}

string `{`$full_class_name`}::get_plural_name( ) const
{
   return static_plural_name( );
}

string `{`$full_class_name`}::get_module_id( ) const
{
`{`@eq`(`$is_alias`,`'true`'`)\
   return parent_class_type::get_module_id( );\
`,\
   return static_module_id( );\
`}
}

string `{`$full_class_name`}::get_module_name( ) const
{
`{`@eq`(`$is_alias`,`'true`'`)\
   return parent_class_type::get_module_name( );\
`,\
   return static_module_name( );\
`}
}
`{`(`?`$fixed_key`)
const string& `{`$full_class_name`}::get_fixed_key( ) const
{
   return c_fixed_key_value;
}\
`}

string `{`$full_class_name`}::get_display_name( bool plural ) const
{
   string key( plural ? "plural_" : "class_" );
   key += "`{`@lower`(`$class_name`)`}";

   return get_module_string( key );
}

bool `{`$full_class_name`}::get_is_alias( ) const
{
`{`@eq`(`$is_alias`,`'true`'`)\
   return true;\
`,\
   return false;\
`}
}

void `{`$full_class_name`}::get_alias_base_info( pair< string, string >& alias_base_info ) const
{
`{`@eq`(`$is_alias`,`'true`'`)\
   alias_base_info = make_pair( `{`$parent_class`}::get_class_id( ), `{`$parent_class`}::get_class_name( ) );\
`,\
   ( void )alias_base_info;\
`}
}

void `{`$full_class_name`}::get_base_class_info( vector< pair< string, string > >& base_class_info ) const
{
`{`?`$parent_class`&`!`@eq`(`$is_alias`,`'true`'`)\
   `{`$parent_class`}::get_base_class_info( base_class_info );

   base_class_info.push_back( make_pair( `{`$parent_class`}::get_class_id( ), `{`$parent_class`}::get_class_name( ) ) );\
`,\
   ( void )base_class_info;\
`}
}

class_base& `{`$full_class_name`}::get_or_create_graph_child( const string& context )
{
   class_base* p_class_base( 0 );

   string::size_type pos = context.find( '.' );
   string sub_context( context.substr( 0, pos ) );

   if( sub_context.empty( ) )
      throw runtime_error( "unexpected empty sub-context" );
`{`?`$child_info`[`$child_info`%,`,`{`;KLUDGE: Compiler limits (for VC++) require the block depth to be <= 100`}\
   `{`!`@eq`(`'\#`'`,`'100`'`)`&`!`@eq`(`'\#`'`,`'200`'`)`&`!`@eq`(`'\#`'`,`'300`'`)else `}if( sub_context == "_\3" || sub_context == "\0" )
      p_class_base = &\0( );
`]`}`{`[`$parent_fields`,\
   else if( sub_context == c_field_id_\$ || sub_context == c_field_name_\$ )
      p_class_base = &\$( );
`]`}`{`(`?`$parent_class`)\
   else
      return parent_class_type::get_or_create_graph_child( context );
`}`{`!`?`$child_info`&`!`?`$parent_class`&`@eq`(`$parent_fields`,`'`'`)`}
   if( !p_class_base )
      throw runtime_error( "unknown sub-context '" + sub_context + "'" );

   if( pos != string::npos )
      p_class_base = &p_class_base->get_or_create_graph_child( context.substr( pos + 1 ) );

   return *p_class_base;
}

void `{`$full_class_name`}::get_sql_column_names(
 vector< string >& names, bool* p_done, const string* p_class_name ) const
{
`{`(`?`$parent_class`)\
   parent_class_type::get_sql_column_names( names, p_done, p_class_name );
`,\
`{`!`(`?`$all_fields`)\
   ( void )names;
`}`}
   if( p_done && *p_done )
      return;
`{`(`?`$non_transient_fields`)\n`}`{`?`$non_transient_fields`[`$non_transient_fields`%,`,\
   names.push_back( "C_\0" );\
`+\n`]`}

   if( p_done && p_class_name && *p_class_name == static_class_name( ) )
      *p_done = true;
}

void `{`$full_class_name`}::get_sql_column_values(
 vector< string >& values, bool* p_done, const string* p_class_name ) const
{
`{`(`?`$parent_class`)\
   parent_class_type::get_sql_column_values( values, p_done, p_class_name );
`,\
`{`!`(`?`$non_transient_fields`)\
   ( void )values;
`}`}
   if( p_done && *p_done )
      return;
`{`(`?`$non_transient_fields`)\n`}`{`?`$non_transient_fields`[`$non_transient_fields`%,`,\
`{`?`$sql_numeric_fields`&`@in`(`'\0`'`,`$sql_numeric_fields`)\
   values.push_back( to_string( \0( ) ) );\
`,\
   values.push_back( sql_quote( to_string( \0( ) ) ) );\
`}`+\n`]`}

   if( p_done && p_class_name && *p_class_name == static_class_name( ) )
      *p_done = true;
}

void `{`$full_class_name`}::get_required_field_names(
 set< string >& names, bool use_transients, set< string >* p_dependents ) const
{
   set< string > local_dependents;
`{`(`?`$parent_class`)
   parent_class_type::get_required_field_names( names,
    use_transients, p_dependents ? p_dependents : &local_dependents );
`}
   set< string >& dependents( p_dependents ? *p_dependents : local_dependents );

   get_always_required_field_names( names, use_transients, dependents );
`{`?`$all_get_required_field_names_specifications`[`$all_get_required_field_names_specifications`%,`,\
`{`@eq`(`'\1`'`,`'field_bool_dtm`'`)
`{`#field_bool_dtm.spec.xrep section=get_required_field_names full_class_name=$full_class_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield`}\
`,\
`@eq`(`'\1`'`,`'field_bool_from_other_enum`'`)
`{`#field_bool_from_other_enum.spec.xrep section=get_required_field_names full_class_name=$full_class_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield`}\
`,\
`@eq`(`'\1`'`,`'field_bool_has_changed`'`)
`{`#field_bool_has_changed.spec.xrep section=get_required_field_names full_class_name=$full_class_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield`}\
`,\
`@eq`(`'\1`'`,`'field_bool_is_default`'`)
`{`#field_bool_is_default.spec.xrep section=get_required_field_names full_class_name=$full_class_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield`}\
`,\
`@eq`(`'\1`'`,`'field_bool_matched_clone`'`)
`{`#field_bool_matched_clone.spec.xrep section=get_required_field_names full_class_name=$full_class_name\
 arg_field=$specification_\0_field arg_tfield=$specification_\0_tfield`}\
`,\
`@eq`(`'\1`'`,`'field_dependency`'`)
`{`#field_dependency.spec.xrep section=get_required_field_names full_class_name=$full_class_name\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield`}\
`,\
`@eq`(`'\1`'`,`'field_from_acyclic_path`'`)`&`@eq`(`$specification_\0_ftransient`,`'1`'`)
`{`#field_from_acyclic_path.spec.xrep section=get_required_field_names\
 arg_pfield=$specification_\0_pfield arg_src_field=$specification_\0_src_field arg_dest_field=$specification_\0_dest_field`}\
`,\
`@eq`(`'\1`'`,`'field_from_op`'`)`&`@eq`(`$specification_\0_procedure`,`'`'`)
`{`#field_from_op.spec.xrep section=get_required_field_names\
 arg_field=$specification_\0_field arg_ofield=$specification_\0_ofield\
 arg_sfield=$specification_\0_sfield arg_spfield=$specification_\0_spfield arg_tfield=$specification_\0_tfield`}\
`,\
`@eq`(`'\1`'`,`'field_from_other_field`'`)`&`@eq`(`$specification_\0_procedure`,`'`'`)
`{`#field_from_other_field.spec.xrep section=get_required_field_names\
 arg_sfield=$specification_\0_sfield arg_pfield=$specification_\0_pfield arg_dfield=$specification_\0_dfield\
 arg_tfield=$specification_\0_tfield arg_tpfield=$specification_\0_tpfield`}\
`,\
`@eq`(`'\1`'`,`'field_from_search_replace`'`)
`{`#field_from_search_replace.spec.xrep section=get_required_field_names class_name=$class_name module_name=$module_name\
 arg_dfield=$specification_\0_dfield arg_sfield=$specification_\0_sfield\
 arg_ofield=$specification_\0_ofield arg_field_list=$specification_\0_field_list`}\
`,\
`@eq`(`'\1`'`,`'field_from_unary_op`'`)`&`@eq`(`$specification_\0_procedure`,`'`'`)
`{`#field_from_unary_op.spec.xrep section=get_required_field_names\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield arg_tfield=$specification_\0_tfield`}\
`,\
`@eq`(`'\1`'`,`'field_swap_fk`'`)`&`@eq`(`$specification_\0_procedure`,`'`'`)
`{`#field_swap_fk.spec.xrep section=get_required_field_names\
 arg_fk_1=$specification_\0_fk_1 arg_fk_2=$specification_\0_fk_2 arg_tfield=$specification_\0_tfield\
 arg_ofield=$specification_\0_ofield arg_o2field=$specification_\0_o2field`}\
`,\
`@eq`(`'\1`'`,`'field_to_value`'`)`&`!`@eq`(`$specification_\0_tfield`,`'`'`)`&`@eq`(`$specification_\0_procedure`,`'`'`)
`{`#field_to_value.spec.xrep section=get_required_field_names\
 arg_field=$specification_\0_field arg_tfield=$specification_\0_tfield`}\
`,\
`@eq`(`'\1`'`,`'meta_relationship_child_name`'`)
`{`#meta_relationship_child_name.spec.xrep section=get_required_field_names\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield\
 arg_pfield1=$specification_\0_pfield1 arg_pfield2=$specification_\0_pfield2\
 arg_pcfield1=$specification_\0_pcfield1 arg_pcfield2=$specification_\0_pcfield2`}\
`,\
`@eq`(`'\1`'`,`'transient_add_action_child_create_for_uid`'`)
`{`#transient_add_action_child_create_for_uid.spec.xrep section=get_required_field_names\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield arg_tfield=$specification_\0_tfield`}\
`,\
`@eq`(`'\1`'`,`'transient_event_overlap`'`)
`{`#transient_event_overlap.spec.xrep section=get_required_field_names\
 arg_field=$specification_\0_field arg_user=$specification_\0_user arg_group=$specification_\0_group\
 arg_when=$specification_\0_when arg_duration=$specification_\0_duration arg_finish=$specification_\0_finish`}\
`,\
`@eq`(`'\1`'`,`'transient_field_action`'`)`&`(`!`@eq`(`'`'`,`$specification_\0_ufield`)\
`|`!`@eq`(`'`'`,`$specification_\0_tfield`)`|`!`@eq`(`'`'`,`$specification_\0_altfield`)`)
`{`#transient_field_action.spec.xrep section=get_required_field_names\
 arg_actions=$specification_\0_actions arg_ufield=$specification_\0_ufield\
 arg_tfield=$specification_\0_tfield arg_altfield=$specification_\0_altfield`}\
`,\
`@eq`(`'\1`'`,`'transient_field_action_create_from_fk`'`)
`{`#transient_field_action_create_from_fk.spec.xrep section=get_required_field_names\
 arg_actions=$specification_\0_actions arg_fkfield=$specification_\0_fkfield`}\
`,\
`@eq`(`'\1`'`,`'transient_field_action_for_mod`'`)`&`!`@eq`(`'`'`,`$specification_\0_tfield`)
`{`#transient_field_action_for_mod.spec.xrep section=get_required_field_names\
 arg_actions=$specification_\0_actions arg_tfield=$specification_\0_tfield`}\
`,\
`@eq`(`'\1`'`,`'transient_field_alias`'`)
`{`#transient_field_alias.spec.xrep section=get_required_field_names\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield`}\
`,\
`@eq`(`'\1`'`,`'transient_field_bool_has_child_for_uid`'`)`&`!`@eq`(`'`'`,`$specification_\0_ufield`)
`{`#transient_field_bool_has_child_for_uid.spec.xrep section=get_required_field_names\
 arg_field=$specification_\0_field arg_ufield=$specification_\0_ufield`}\
`,\
`@eq`(`'\1`'`,`'transient_field_concat`'`)
`{`#transient_field_concat.spec.xrep section=get_required_field_names\
 arg_dfield=$specification_\0_dfield arg_field1=$specification_\0_field1\
 arg_field2=$specification_\0_field2 arg_field3=$specification_\0_field3`}\
`,\
`@eq`(`'\1`'`,`'transient_field_from_op`'`)
`{`#transient_field_from_op.spec.xrep section=get_required_field_names\
 arg_field=$specification_\0_field arg_ofield=$specification_\0_ofield\
 arg_sfield=$specification_\0_sfield arg_spfield=$specification_\0_spfield arg_tfield=$specification_\0_tfield`}\
`,\
`@eq`(`'\1`'`,`'transient_field_from_unary_op`'`)
`{`#transient_field_from_unary_op.spec.xrep section=get_required_field_names\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield arg_tfield=$specification_\0_tfield`}\
`,\
`@eq`(`'\1`'`,`'transient_field_from_variable`'`)`&`!`@eq`(`'`'`,`$specification_\0_sfield`)
`{`#transient_field_from_variable.spec.xrep section=get_required_field_names\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield arg_spfield=$specification_\0_spfield`}\
`,\
`@eq`(`'\1`'`,`'transient_field_value_if_uid_in_set`'`)
`{`#transient_field_value_if_uid_in_set.spec.xrep section=get_required_field_names\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield`}\
`,\
`@eq`(`'\1`'`,`'transient_permission_concat`'`)
`{`#transient_permission_concat.spec.xrep section=get_required_field_names\
 arg_field=$specification_\0_field arg_tfield=$specification_\0_tfield`}\
### get_required_field_names
`}`]`}

   // [<start get_required_field_names>]
`{`(`?`$user_source`)`#$user_source section=get_required_field_names`}
   // [<finish get_required_field_names>]
}

void `{`$full_class_name`}::get_always_required_field_names(
 set< string >& names, bool use_transients, set< string >& dependents ) const
{
`{`(`?`$parent_class`)\
   parent_class_type::get_always_required_field_names( names, use_transients, dependents );\
`,\
   ( void )names;
   ( void )dependents;
   ( void )use_transients;\
`}
`{`?`$all_get_always_required_field_names_specifications`[`$all_get_always_required_field_names_specifications`%,`,\
`{`@eq`(`'\1`'`,`'filter_field_value`'`)
`{`#filter_field_value.spec.xrep section=get_always_required_field_names arg_name=\0\
 arg_id=$specification_\0_id arg_field=$specification_\0_field arg_tfield=$specification_\0_tfield`}\
`,\
`@eq`(`'\1`'`,`'filter_fk_in_uid_set`'`)
`{`#filter_fk_in_uid_set.spec.xrep section=get_always_required_field_names arg_name=\0\
 arg_id=$specification_\0_id arg_tfield=$specification_\0_tfield\
 arg_vname=$specification_\0_vname arg_spfield=$specification_\0_spfield`}\
`,\
`@eq`(`'\1`'`,`'filter_perm_restricted`'`)
`{`#filter_perm_restricted.spec.xrep section=get_always_required_field_names arg_name=\0\
 arg_id=$specification_\0_id arg_field=$specification_\0_field`}\
`,\
`@eq`(`'\1`'`,`'filter_security_level`'`)
`{`#filter_security_level.spec.xrep section=get_always_required_field_names arg_name=\0\
 arg_id=$specification_\0_id arg_slevel=$specification_\0_slevel`}\
`,\
`@eq`(`'\1`'`,`'modifier_date_notification`'`)
`{`#modifier_date_notification.spec.xrep section=get_always_required_field_names\
 arg_field=$specification_\0_field arg_modifier=$specification_\0_modifier`}\
`,\
`@eq`(`'\1`'`,`'modifier_field_compare`'`)
`{`#modifier_field_compare.spec.xrep section=get_always_required_field_names\
 arg_field=$specification_\0_field arg_sfield=$specification_\0_sfield arg_pfield=$specification_\0_pfield\
 arg_modifier=$specification_\0_modifier arg_tfield=$specification_\0_tfield arg_tpfield=$specification_\0_tpfield`}\
`,\
`@eq`(`'\1`'`,`'modifier_field_null`'`)
`{`#modifier_field_null.spec.xrep section=get_always_required_field_names\
 arg_field=$specification_\0_field arg_pfield=$specification_\0_pfield arg_modifier=$specification_\0_modifier\
 arg_tfield=$specification_\0_tfield arg_tpfield=$specification_\0_tpfield`}\
`,\
`@eq`(`'\1`'`,`'modifier_field_value`'`)
`{`#modifier_field_value.spec.xrep section=get_always_required_field_names\
 arg_field=$specification_\0_field arg_pfield=$specification_\0_pfield arg_modifier=$specification_\0_modifier\
 arg_tfield=$specification_\0_tfield arg_tpfield=$specification_\0_tpfield`}\
`,\
`@eq`(`'\1`'`,`'modifier_past_date_time`'`)
`{`#modifier_past_date_time.spec.xrep section=get_always_required_field_names\
 arg_dfield=$specification_\0_dfield arg_tfield=$specification_\0_tfield arg_modifier=$specification_\0_modifier`}\
`,\
`@eq`(`'\1`'`,`'modifier_permission`'`)`&`!`@eq`(`'`'`,`$specification_\0_ufield`)
`{`#modifier_permission.spec.xrep section=get_always_required_field_names arg_ufield=$specification_\0_ufield`}\
`,\
`@eq`(`'\1`'`,`'move_up_and_down`'`)
`{`#move_up_and_down.spec.xrep section=get_always_required_field_names\
 arg_field=$specification_\0_field arg_update_parent=$specification_\0_update_parent`}\
`,\
`@eq`(`'\1`'`,`'permit_ignore_uneditable`'`)`&`!`@eq`(`'`'`,`$specification_\0_tfield`)
`{`#permit_ignore_uneditable.spec.xrep section=get_always_required_field_names arg_tfield=$specification_\0_tfield`}\
`,\
`@eq`(`'\1`'`,`'permit_user_ignore_uneditable`'`)`&`!`@eq`(`'`'`,`$specification_\0_tpfield`)
`{`#permit_user_ignore_uneditable.spec.xrep section=get_always_required_field_names class_name=$class_name\
 arg_tpfield=$specification_\0_tpfield`}\
`,\
`@eq`(`'\1`'`,`'protect_equal`'`)
`{`#protect_equal.spec.xrep section=get_always_required_field_names\
 arg_field=$specification_\0_field arg_pfield=$specification_\0_pfield`}\
`,\
`@eq`(`'\1`'`,`'protect_not_equal`'`)
`{`#protect_not_equal.spec.xrep section=get_always_required_field_names\
 arg_field=$specification_\0_field arg_pfield=$specification_\0_pfield`}\
`,\
`@eq`(`'\1`'`,`'restrict_protect`'`)
`{`#restrict_protect.spec.xrep section=get_always_required_field_names\
 arg_field=$specification_\0_field arg_pfield=$specification_\0_pfield arg_tfield=$specification_\0_tfield`}\
`,\
`@eq`(`'\1`'`,`'restrict_uid_not_equal`'`)
`{`#restrict_uid_not_equal.spec.xrep section=get_always_required_field_names\
 arg_ufield=$specification_\0_ufield arg_sfield=$specification_\0_sfield arg_tfield=$specification_\0_tfield`}\
`,\
`@eq`(`'\1`'`,`'state_protect`'`)`{`;NOTE: This can be removed when modeller.exe is no longer used.`}
`{`#$specification_\0_spec_file section=get_always_required_field_names name=\0\
 arg_field=$specification_\0_field arg_pfield=$specification_\0_pfield`}\
`,\
`@eq`(`'\1`'`,`'total_child_field_in_parent`'`)
`{`#total_child_field_in_parent.spec.xrep section=get_always_required_field_names class_name=$class_name\
 arg_nfield=$specification_\0_nfield arg_n2field=$specification_\0_n2field arg_n3field=$specification_\0_n3field\
 arg_pfield=$specification_\0_pfield arg_tfield=$specification_\0_tfield arg_sfield=$specification_\0_sfield`}\
`,\
`@eq`(`'\1`'`,`'unactionable_field_value`'`)
`{`#unactionable_field_value.spec.xrep section=get_always_required_field_names\
 arg_field=$specification_\0_field arg_pfield=$specification_\0_pfield arg_value=$specification_\0_value`}\
`,\
`@eq`(`'\1`'`,`'update_parent_cascade`'`)
`{`#update_parent_cascade.spec.xrep section=get_always_required_field_names\
 arg_pfield=$specification_\0_pfield`}\
### get_always_required_field_names
`}`]`}

   // [<start get_always_required_field_names>]
`{`(`?`$user_source`)`#$user_source section=get_always_required_field_names`}
   // [<finish get_always_required_field_names>]
}

void `{`$full_class_name`}::get_transient_replacement_field_names( const string& name, vector< string >& names ) const
{
`{`(`?`$parent_class`)\
   parent_class_type::get_transient_replacement_field_names( name, names );\
`,\
   ( void )name;
   ( void )names;\
`}
`{`?`$all_get_transient_replacement_field_names_specifications`[`$all_get_transient_replacement_field_names_specifications`%,`,\
`{`@eq`(`'\1`'`,`'dummy`'`)
`{`#dummy.spec.xrep section=get_transient_replacement_field_names module_name=$module_name class_name=$class_name`}\
### get_transient_replacement_field_names
`}`]`}

   // [<start get_transient_replacement_field_names>]
`{`(`?`$user_source`)`#$user_source section=get_transient_replacement_field_names`}
   // [<finish get_transient_replacement_field_names>]
}

void `{`$full_class_name`}::do_generate_sql(
 generate_sql_type type, vector< string >& sql_stmts, set< string >& tx_key_info ) const
{
`{`?`$parent_class`&`!`@eq`(`$is_alias`,`'true`'`)\
   parent_class_type::do_generate_sql( type, sql_stmts, tx_key_info );
`}
   generate_sql( static_class_name( ), type, sql_stmts, tx_key_info );
}

const char* `{`$full_class_name`}::static_resolved_module_id( )
{
`{`@eq`(`$is_alias`,`'true`'`)\
   return parent_class_type::static_module_id( );\
`,\
   return static_module_id( );\
`}
}

const char* `{`$full_class_name`}::static_resolved_module_name( )
{
`{`@eq`(`$is_alias`,`'true`'`)\
   return parent_class_type::static_module_name( );\
`,\
   return static_module_name( );\
`}
}

const char* `{`$full_class_name`}::static_lock_class_id( )
{
`{`(`?`$parent_class`)\
   return parent_class_type::static_lock_class_id( );\
`,\
   return "`{`$class_id`}";\
`}
}

const char* `{`$full_class_name`}::static_check_class_name( )
{
`{`(`?`$parent_class`)\
   return parent_class_type::static_check_class_name( );\
`,\
   return "`{`$class_name`}";\
`}
}

bool `{`$full_class_name`}::static_has_derivations( )
{
   return !g_derivations.empty( );
}

void `{`$full_class_name`}::static_get_class_info( class_info_container& class_info )
{
`{`(`?`$parent_class`)\
   parent_class_type::static_get_class_info( class_info );\
`}
`{`(`?`$all_fields`)\
   class_info.push_back( "`{`$module_id`}.`{`$class_id`}" );\
`}
}

void `{`$full_class_name`}::static_get_field_info( field_info_container& all_field_info )
{
`{`(`?`$parent_class`)\
   parent_class_type::static_get_field_info( all_field_info );\
`,\
`{`!`(`?`$all_fields`)\
   ( void )all_field_info;
`}`}
`{`?`$all_fields`[`$all_fields`%,`,\
   all_field_info.push_back( field_info( "\2", "\0", "\1", \
`{`?`$mandatory_parent_fields`&`@in`(`'\0`'`,`$mandatory_parent_fields`)true`,false`} ) );\
`+\n`]`}
}

void `{`$full_class_name`}::static_get_foreign_key_info( foreign_key_info_container& foreign_key_info )
{
   ( void )foreign_key_info;
`{`(`?`$parent_class`)
   parent_class_type::static_get_foreign_key_info( foreign_key_info );\
`}
`{`?`$all_fields`[`$all_fields`%,`'`'\
`{`@in`(`'\0`'`,`$parent_fields`)
   foreign_key_info.insert( foreign_key_info_value_type( c_field_id_\0, make_pair( "`{`$module_name`}.`{`$class_id`}", "\1" ) ) );\
`}`]`}
}

int `{`$full_class_name`}::static_get_num_fields( bool* p_done, const string* p_class_name )
{
`{`!`(`?`$parent_class`)\
   if( p_done && p_class_name && *p_class_name == static_class_name( ) )
      *p_done = true;

   return c_num_fields;\
`,\
   int num_fields( parent_class_type::static_get_num_fields( p_done, p_class_name ) );

   if( p_done && *p_done )
      return num_fields;

   num_fields += c_num_fields;

   if( p_done && p_class_name && *p_class_name == static_class_name( ) )
      *p_done = true;

   return num_fields;\
`}
}

bool `{`$full_class_name`}::static_is_field_transient( field_id id )
{
   return is_transient_field( static_get_field_id( id ) );
}

const char* `{`$full_class_name`}::static_get_field_id( field_id id )
{
   const char* p_id = 0;

`{`(`?`$parent_class`)\
   int num_parent_fields( parent_class_type::static_get_num_fields( ) );

   if( ( int )id < num_parent_fields )
      p_id = parent_class_type::static_get_field_id( ( parent_class_type::field_id )id );
`}
`{`(`?`$all_fields`)\
   switch( id )
   {
`{`[`$all_fields`%,`,\
      case \\+:
      p_id = "\\2";
      break;
`+\n`]`}\
   }
`}
   if( !p_id )
      throw runtime_error( "unknown field id #" + to_string( id ) + " for class `{`$class_name`}" );

   return p_id;
}

const char* `{`$full_class_name`}::static_get_field_name( field_id id )
{
   const char* p_id = 0;

`{`(`?`$parent_class`)\
   int num_parent_fields( parent_class_type::static_get_num_fields( ) );

   if( ( int )id < num_parent_fields )
      p_id = parent_class_type::static_get_field_id( ( parent_class_type::field_id )id );
`}
`{`(`?`$all_fields`)\
   switch( id )
   {
`{`[`$all_fields`%,`,\
      case \\+:
      p_id = "\\0";
      break;
`+\n`]`}\
   }
`}
   if( !p_id )
      throw runtime_error( "unknown field id #" + to_string( id ) + " for class `{`$class_name`}" );

   return p_id;
}

int `{`$full_class_name`}::static_get_field_num( const string& field )
{
`{`(`!`?`$parent_class`)\
   int rc = 0;
`,\
   int rc = parent_class_type::static_get_field_num( field );
   if( rc >= 0 )
      return rc;

   rc = parent_class_type::static_get_num_fields( );
`}
   if( field.empty( ) )
      throw runtime_error( "unexpected empty field name/id for static_get_field_num( )" );
`{`?`$all_fields`[`$all_fields`%,`,\
   else if( field == c_field_id_\0 || field == c_field_name_\0 )
      rc += \+;
`]`}
   return rc - 1;
}

procedure_info_container& `{`$full_class_name`}::static_get_procedure_info( )
{
`{`(`?`$all_procedure_info`)\
   static bool initialised = false;
`}`{`(`?`$parent_class`)\
   static procedure_info_container& procedures( parent_class_type::static_get_procedure_info( ) );
`,\
   static procedure_info_container procedures;
`}
`{`(`?`$all_procedure_info`)\
   if( !initialised )
   {
      initialised = true;
`{`[`$all_procedure_info`%,`,\
      procedures.insert( make_pair( "\\0", "\\1" ) );\
`+\n`]`}
   }
`}
   return procedures;
}

string `{`$full_class_name`}::static_get_sql_columns( )
{
   string sql_columns;

`{`!`@eq`(`$sql_columns`,`'`'`)\
   sql_columns += `{`$tmp`=`$sql_columns`/ `/~`/\n`/ `}`{`[`$tmp`,
    "`{`$tmp`=`'\\?`'`}`{`$tmp`/~`/ `}"`]`};
`}
   return sql_columns;
}

void `{`$full_class_name`}::static_get_text_search_fields( vector< string >& fields )
{
`{`(`?`$parent_class`)\
   parent_class_type::static_get_text_search_fields( fields );\
`,\
`!`(`?`$text_search_fields`)\
   ( void )fields;\
`}
`{`?`$text_search_fields`[`$text_search_fields`,\
   fields.push_back( "\$" );\
`+\n`]`}
}

void `{`$full_class_name`}::static_get_all_enum_pairs( vector< pair< string, string > >& pairs )
{
`{`(`?`$parent_class`)\
   parent_class_type::static_get_all_enum_pairs( pairs );\
`,\
`!`(`?`$all_enums`)\
   ( void )pairs;\
`}
`{`(`?`$all_enums`)`[`$all_enums`%,`,\
`{`[`$enum_\0`%=`,\
   pairs.push_back( make_pair( "enum_\0_\\0", get_enum_string_\0( `{`@eq`(`'\2`'`,`'numlit`'`)\\0`,"\\0"`} ) ) );\
`+\n`]`}`+\n\n`]`}
}

void `{`$full_class_name`}::static_get_sql_indexes( vector< string >& indexes )
{
`{`?`$parent_class`&`!`@eq`(`$is_alias`,`'true`'`)\
   parent_class_type::static_get_sql_indexes( indexes );`{`(`?`$all_sql_indexes`)\n`}\
`,\
`{`!`(`?`$all_sql_indexes`)`|`@eq`(`$all_sql_indexes`,`'`'`)\
   ( void )indexes;\
`}`}
`{`?`$all_sql_indexes`[`$all_sql_indexes`,\
   indexes.push_back( "\$" );\
`+\n`]`}
}

void `{`$full_class_name`}::static_get_sql_unique_indexes( vector< string >& indexes )
{
`{`(`?`$parent_class`)\
   parent_class_type::static_get_sql_unique_indexes( indexes );`{`(`?`$all_sql_unique_indexes`)\n`}\
`,\
`{`!`(`?`$all_sql_unique_indexes`)`|`@eq`(`$all_sql_unique_indexes`,`'`'`)\
   ( void )indexes;\
`}`}
`{`?`$all_sql_unique_indexes`[`$all_sql_unique_indexes`,\
   indexes.push_back( "\$" );\
`+\n`]`}
}

void `{`$full_class_name`}::static_insert_derivation( const string& module_and_class_id )
{
   g_derivations.insert( module_and_class_id );
}

void `{`$full_class_name`}::static_remove_derivation( const string& module_and_class_id )
{
   if( g_derivations.count( module_and_class_id ) )
      g_derivations.erase( module_and_class_id );
}

void `{`$full_class_name`}::static_insert_external_alias( const string& module_and_class_id, `{`$full_class_name`}* p_instance )
{
   g_external_aliases.insert( external_aliases_value_type( module_and_class_id, p_instance ) );
}

void `{`$full_class_name`}::static_remove_external_alias( const string& module_and_class_id )
{
   if( g_external_aliases.count( module_and_class_id ) )
   {
      delete g_external_aliases[ module_and_class_id ];
      g_external_aliases.erase( module_and_class_id );
   }
}

void `{`$full_class_name`}::static_class_init( const char* p_module_name )
{
   if( !p_module_name )
      throw runtime_error( "unexpected null module name pointer for init" );

`{`@eq`(`$is_alias`,`'true`'`)\
   `{`$parent_class`}::static_insert_external_alias( "`{`$full_class_name`}", new `{`$full_class_name`} );
`,\
`{`(`?`$parent_class`)\
   `{`$parent_class`}::static_insert_derivation( "`{`$full_class_name`}" );
`}`}`{`(`?`$file_field_names`)`[`$file_field_names`,\
   g_file_field_names.insert( "\$" );
`]`}`{`(`?`$file_field_names`&`?`$all_enums`)\n`}`{`(`?`$all_enums`)`[`$all_enums`%,`,\
`{`[`$enum_\0`%=`,\
   g_\0_enum.insert( `{`@eq`(`'\2`'`,`'numlit`'`)\\0`,"\\0"`} );
`]`}`+\n`]`}`{`?`$all_static_class_init_specifications`[`$all_static_class_init_specifications`%,`,\
`{`@eq`(`'\1`'`,`'dummy`'`)
`{`#dummy.spec.xrep section=static_class_init full_class_name=$full_class_name`}
### static_class_init
`}`]`}
   // [<start static_class_init>]
`{`(`?`$user_source`)`#$user_source section=static_class_init`}
   // [<finish static_class_init>]
}

void `{`$full_class_name`}::static_class_term( const char* p_module_name )
{
   if( !p_module_name )
      throw runtime_error( "unexpected null module name pointer for term" );

`{`@eq`(`$is_alias`,`'true`'`)\
   `{`$parent_class`}::static_remove_external_alias( "`{`$full_class_name`}" );
`,\
`{`(`?`$parent_class`)\
   `{`$parent_class`}::static_remove_derivation( "`{`$full_class_name`}" );
`}`}
`{`?`$all_static_class_term_specifications`[`$all_static_class_term_specifications`%,`,\
`{`@eq`(`'\1`'`,`'dummy`'`)
`{`#dummy.spec.xrep section=static_class_term full_class_name=$full_class_name`}
### static_class_term
`}`]`}
   // [<start static_class_term>]
`{`(`?`$user_source`)`#$user_source section=static_class_term`}
   // [<finish static_class_term>]
}

